<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HealthTrack</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    :root {
      --primary: #00c9a7;
      --secondary: #007bff;
      --dark-bg: #0d1117;
      --darker-bg: #0a0e13;
      --card-bg: #161b22;
      --text-primary: #ffffff;
      --text-secondary: #b0b0b0;
      --danger: #ff6b6b;
      --success: #6bce70;
      --warning: #ffc107;
      --info: #17a2b8;
      --sidebar-width: 280px;
      --sidebar-collapsed-width: 80px;
      --topbar-height: 70px;
      --transition-speed: 0.3s;
    }

    [data-theme="light"] {
      --dark-bg: #f8f9fa;
      --darker-bg: #e9ecef;
      --card-bg: #ffffff;
      --text-primary: #212529;
      --text-secondary: #495057;
      --sidebar-bg: #343a40;
      --sidebar-text: #e9ecef;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(145deg, var(--darker-bg), var(--dark-bg));
      color: var(--text-primary);
      font-family: 'Poppins', sans-serif;
      animation: fadeIn 0.8s ease-in-out;
      min-height: 100vh;
      transition: background 0.3s ease;
      overflow-x: hidden;
    }
    

    /* Layout */
    .app-container {
      display: flex;
      min-height: 100vh;
      transition: margin-left var(--transition-speed);
    }

    /* Sidebar */
    .sidebar {
      width: var(--sidebar-width);
      height: 100vh;
      background-color: var(--darker-bg);
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
      transition: width var(--transition-speed);
      overflow: hidden;
      border-right: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    }

    .sidebar-collapsed {
      width: var(--sidebar-collapsed-width);
    }

    .sidebar-header {
      height: var(--topbar-height);
      display: flex;
      align-items: center;
      padding: 0 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .sidebar-logo {
      color: var(--primary);
      font-size: 1.5rem;
      font-weight: 600;
      white-space: nowrap;
      transition: all var(--transition-speed);
    }

    .sidebar-collapsed .sidebar-logo {
      font-size: 1.8rem;
      margin-left: 0.5rem;
    }

    .sidebar-menu {
      padding: 1rem 0;
      height: calc(100vh - var(--topbar-height));
      overflow-y: auto;
    }

    .sidebar-menu::-webkit-scrollbar {
      width: 5px;
    }

    .sidebar-menu::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 5px;
    }

    .menu-item {
      display: flex;
      align-items: center;
      padding: 0.8rem 1.5rem;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.2s ease;
      white-space: nowrap;
      position: relative;
      margin: 0.2rem 0;
    }

    .menu-item:hover {
      color: var(--text-primary);
      background-color: rgba(0, 201, 167, 0.1);
    }

    .menu-item.active {
      color: var(--primary);
      background-color: rgba(0, 201, 167, 0.2);
    }

    .menu-item.active::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background-color: var(--primary);
    }

    .menu-icon {
      font-size: 1.2rem;
      margin-right: 1rem;
      min-width: 24px;
      transition: all var(--transition-speed);
    }

    .sidebar-collapsed .menu-text {
      opacity: 0;
      width: 0;
      transition: opacity var(--transition-speed), width var(--transition-speed);
    }

    .sidebar-collapsed .menu-item {
      justify-content: center;
      padding: 0.8rem 0;
    }

    .sidebar-collapsed .menu-icon {
      margin-right: 0;
      font-size: 1.4rem;
    }

    /* Main content */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      transition: margin-left var(--transition-speed);
      padding-top: var(--topbar-height);
      min-height: 100vh;
    }

    .sidebar-collapsed ~ .main-content {
      margin-left: var(--sidebar-collapsed-width);
    }

    /* Topbar */
    .topbar {
      position: fixed;
      top: 0;
      right: 0;
      left: var(--sidebar-width);
      height: var(--topbar-height);
      background-color: var(--card-bg);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 2rem;
      z-index: 900;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      transition: left var(--transition-speed);
    }

    .sidebar-collapsed ~ .main-content .topbar {
      left: var(--sidebar-collapsed-width);
    }

    .topbar-left {
      display: flex;
      align-items: center;
    }

    .toggle-sidebar {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.2rem;
      cursor: pointer;
      margin-right: 1rem;
      transition: all 0.2s ease;
    }

    .toggle-sidebar:hover {
      color: var(--primary);
      transform: scale(1.1);
    }

    .page-title {
      font-weight: 600;
      margin: 0;
      color: var(--text-primary);
    }

    .topbar-right {
      display: flex;
      align-items: center;
    }

    .theme-toggle {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.2rem;
      cursor: pointer;
      margin-right: 1rem;
      transition: all 0.2s ease;
    }

    .theme-toggle:hover {
      color: var(--warning);
      transform: scale(1.1);
    }

    .user-profile {
      display: flex;
      align-items: center;
      cursor: pointer;
      position: relative;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      margin-left: 1rem;
      transition: all 0.3s ease;
    }

    .user-avatar:hover {
      transform: scale(1.1);
      box-shadow: 0 0 0 3px rgba(0, 201, 167, 0.3);
    }

    .user-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background-color: var(--card-bg);
      border-radius: 0.5rem;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
      padding: 0.5rem 0;
      min-width: 200px;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transform: translateY(10px);
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .user-profile:hover .user-dropdown {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-item {
      padding: 0.5rem 1rem;
      color: var(--text-primary);
      text-decoration: none;
      display: flex;
      align-items: center;
      transition: all 0.2s ease;
    }

    .dropdown-item:hover {
      background-color: rgba(0, 201, 167, 0.1);
      color: var(--primary);
    }

    .dropdown-icon {
      margin-right: 0.75rem;
      width: 20px;
      text-align: center;
    }

    /* Dashboard content */
    .dashboard {
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    @media (max-width: 992px) {
      .sidebar {
        transform: translateX(-100%);
      }
      
      .sidebar-collapsed {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
      }
      
      .topbar {
        left: 0;
      }
      
      .mobile-menu-btn {
        display: block;
      }
    }

    /* Animations */
    @keyframes fadeIn {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }

    @keyframes slideDown {
      0% { opacity: 0; transform: translateY(-30px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInUp {
      0% { opacity: 0; transform: translateY(30px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(0, 201, 167, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(0, 201, 167, 0); }
      100% { box-shadow: 0 0 0 0 rgba(0, 201, 167, 0); }
    }

    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    /* Card styles */
    .card {
      border: none;
      border-radius: 1rem;
      background-color: var(--card-bg);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
      animation: fadeInUp 0.6s ease forwards;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.05);
      overflow: hidden;
      position: relative;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      opacity: 0.8;
    }

    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
    }

    .card-header {
      border-radius: 1rem 1rem 0 0;
      font-weight: 600;
      font-size: 1.1rem;
      background-color: rgba(0, 0, 0, 0.2);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      padding: 1rem 1.5rem;
    }

    .card-body {
      padding: 1.5rem;
    }

    /* Form elements */
    .form-control, textarea, .form-select {
      background-color: rgba(13, 17, 23, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
      padding: 0.75rem 1rem;
      border-radius: 0.75rem;
      transition: all 0.3s ease;
    }

    [data-theme="light"] .form-control,
    [data-theme="light"] textarea,
    [data-theme="light"] .form-select {
      background-color: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(0, 0, 0, 0.1);
      color: var(--text-primary);
    }

    .form-control:focus, textarea:focus, .form-select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 0.2rem rgba(0, 201, 167, 0.25);
      background-color: rgba(13, 17, 23, 0.9);
    }

    [data-theme="light"] .form-control:focus,
    [data-theme="light"] textarea:focus,
    [data-theme="light"] .form-select:focus {
      background-color: white;
    }

    /* Buttons */
    .btn-custom {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border: none;
      padding: 12px 28px;
      border-radius: 50px;
      font-weight: 600;
      color: #fff;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.1);
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 201, 167, 0.3);
    }

    .btn-custom:hover {
      transform: translateY(-3px) scale(1.03);
      box-shadow: 0 8px 25px rgba(0, 201, 167, 0.4);
    }

    .btn-custom:active {
      transform: translateY(1px);
    }

    .btn-custom::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0));
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .btn-custom:hover::after {
      opacity: 1;
    }

    /* List items */
    .list-group-item {
      background-color: transparent;
      color: var(--text-primary);
      border: none;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      padding: 1rem 1.5rem;
      transition: all 0.3s ease;
    }

    [data-theme="light"] .list-group-item {
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .list-group-item:hover {
      background-color: rgba(255, 255, 255, 0.03);
      transform: translateX(5px);
    }

    [data-theme="light"] .list-group-item:hover {
      background-color: rgba(0, 0, 0, 0.03);
    }

    .reminder-time {
      font-size: 0.85rem;
      color: var(--text-secondary);
      background-color: rgba(0, 201, 167, 0.15);
      padding: 0.25rem 0.5rem;
      border-radius: 50px;
      transition: all 0.3s ease;
    }

    .list-group-item:hover .reminder-time {
      background-color: rgba(0, 201, 167, 0.3);
      color: white;
    }

    /* Vital stats */
    .vital-stat {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    [data-theme="light"] .vital-stat {
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .vital-stat:last-child {
      border-bottom: none;
    }

    .vital-value {
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--primary);
    }

    /* Progress bars */
    .progress {
      height: 8px;
      border-radius: 4px;
      background-color: rgba(255,255,255,0.1);
      margin-top: 0.5rem;
    }

    [data-theme="light"] .progress {
      background-color: rgba(0, 0, 0, 0.1);
    }

    .progress-bar {
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border-radius: 4px;
    }

    /* Badges */
    .appointment-badge {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      margin-left: 0.5rem;
    }

    .bg-danger {
      background-color: var(--danger) !important;
    }

    .bg-success {
      background-color: var(--success) !important;
    }

    .bg-warning {
      background-color: var(--warning) !important;
    }

    .bg-info {
      background-color: var(--info) !important;
    }

    .bg-primary {
      background-color: var(--primary) !important;
    }

    /* Icons */
    .icon {
      margin-right: 10px;
      transition: transform 0.3s ease;
    }

    .card:hover .icon {
      transform: scale(1.1);
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    /* Health indicators */
    .health-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .excellent { background-color: #6bce70; box-shadow: 0 0 8px #6bce70; }
    .good { background-color: #a3e635; box-shadow: 0 0 8px #a3e635; }
    .fair { background-color: #facc15; box-shadow: 0 0 8px #facc15; }
    .poor { background-color: #f87171; box-shadow: 0 0 8px #f87171; }

    /* Floating action button */
    .fab {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 5px 20px rgba(0, 201, 167, 0.4);
      cursor: pointer;
      z-index: 100;
      animation: float 3s ease-in-out infinite;
      transition: all 0.3s ease;
    }

    .fab:hover {
      transform: scale(1.1) translateY(-5px);
      animation: none;
      box-shadow: 0 8px 25px rgba(0, 201, 167, 0.6);
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.05);
    }

    [data-theme="light"] ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 4px;
    }

    /* Tooltips */
    .tooltip-inner {
      background-color: var(--card-bg);
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      color: var(--text-primary);
    }

    [data-theme="light"] .tooltip-inner {
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .bs-tooltip-auto[data-popper-placement^=top] .tooltip-arrow::before, 
    .bs-tooltip-top .tooltip-arrow::before {
      border-top-color: var(--card-bg);
    }

    /* Account page */
    .account-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .account-card {
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .account-header {
      position: relative;
      height: 200px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding-bottom: 70px;
    }

    .account-avatar {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      background-color: white;
      position: absolute;
      bottom: -70px;
      border: 5px solid var(--card-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3.5rem;
      color: var(--primary);
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }

    .account-avatar:hover {
      transform: scale(1.05);
    }

    .account-body {
      padding: 90px 2rem 2rem;
    }

    .account-info {
      margin-bottom: 2rem;
    }

    .info-item {
      display: flex;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    [data-theme="light"] .info-item {
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .info-label {
      font-weight: 600;
      min-width: 150px;
      color: var(--text-secondary);
    }

    .info-value {
      flex: 1;
    }

    /* Responsive adjustments */
    @media (max-width: 992px) {
      .dashboard {
        padding: 1.5rem;
      }
      
      .card-header {
        padding: 0.75rem 1rem;
      }
      
      .card-body {
        padding: 1rem;
      }
    }

    @media (max-width: 768px) {
      .dashboard {
        padding: 1rem;
      }
      
      .account-body {
        padding: 90px 1rem 1rem;
      }
      
      .info-item {
        flex-direction: column;
      }
      
      .info-label {
        margin-bottom: 0.5rem;
      }
    }

    /* Loading animation */
    .loader {
      display: inline-block;
      width: 30px;
      height: 30px;
      border: 3px solid rgba(0, 201, 167, 0.3);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    
  </style>
    <style>
      /* Add this to hide the hamburger menu toggle */
      @media (max-width: 992px) {
        .toggle-sidebar {
          display: none !important; /* Hide the hamburger menu toggle */
        }
        
        /* Adjust topbar padding since we removed the toggle */
        .topbar-left {
          padding-left: 1rem;
        }
      }
    </style>
</head>

<body class="container" style="background-color: #333333;">

<div class="app-container ">
  <!-- Sidebar -->
  <style>
    #sidebar {
      position: fixed;
      top: 20px;
      bottom: 20px;
      left: 20px;
      width: 180px;
      background-color: #fffdf5;
      color: #222;
      border-radius: 25px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 20px 0;
      z-index: 1040;
      transition: all 0.3s ease;
    }
  
    @media (max-width: 768px) {
      #sidebar {
        width: 60px;
        left: 10px;
        right: auto;
        top: 15px;
        bottom: 15px;
        padding: 15px 0;
      }
  
      #sidebar a {
        font-size: 0;
        justify-content: center;
      }
  
      #sidebar .sidebar-logo span,
      #sidebar a span {
        display: none;
      }
  
      body {
        padding-left: 80px; /* adds right space for content on small screens */
      }
    }
  
    .sidebar-logo {
      text-align: center;
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 30px;
      color: #e74c3c;
    }
  
    #sidebar a {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 20px;
      color: #222;
      text-decoration: none;
      font-size: 14px;
      transition: background 0.2s ease;
    }
  
    #sidebar a:hover {
      background-color: rgba(0, 0, 0, 0.04);
    }
  </style>
  <style>
    /* Desktop sidebar */
    #sidebar {
      position: fixed;
      top: 20px;
      bottom: 20px;
      left: 20px;
      width: 180px;
      background-color: #fffdf5;
      color: #222;
      border-radius: 25px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 20px 0;
      z-index: 1040;
    }
  
    body {
      margin: 0;
      padding-left: 220px; /* Leaves space for sidebar */
    }
  
    /* Mobile adjustments */
    @media (max-width: 768px) {
      #sidebar {
        width: 60px;
        left: 10px;
        top: 15px;
        bottom: 15px;
        padding: 15px 0;
        border-radius: 20px;
      }
  
      body {
        padding-left: 80px; /* Sidebar space */
      }
  
      #sidebar .sidebar-logo span,
      #sidebar a span {
        display: none;
      }
  
      #sidebar a {
        justify-content: center;
        font-size: 0;
      }
    }
  
    .sidebar-logo {
      text-align: center;
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 30px;
      color: #e74c3c;
    }
  
    #sidebar a {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 20px;
      color: #222;
      text-decoration: none;
      font-size: 14px;
      transition: background 0.2s ease;
    }
  
    #sidebar a:hover {
      background-color: rgba(0, 0, 0, 0.04);
    }
  </style>
  
  
  <style>
    #sidebar {
      position: fixed;
      top: 40px;
      bottom: 40px;
      left: 20px;
      width: 180px;
      background-color: #fffdf5;
      color: #222;
      border-radius: 25px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 20px 0;
      z-index: 1040;
    }
  
    .sidebar-logo {
      text-align: center;
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 30px;
      color: #e74c3c;
    }
  
    #sidebar a {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 20px;
      color: #222;
      text-decoration: none;
      font-size: 14px;
      transition: background 0.2s ease;
    }
  
    #sidebar a:hover {
      background-color: rgba(0, 0, 0, 0.04);
    }
  
    /* Push content only a bit */
    body {
      margin: 0;
      padding-left: 220px;
    }
  
    /* === Mobile Responsive === */
    @media (max-width: 768px) {
      #sidebar {
        width: 60px;
        left: 10px;
        top: 15px;
        bottom: 15px;
        padding: 12px 0;
        border-radius: 20px;
      }
  
      .sidebar-logo span,
      #sidebar a span {
        display: none;
      }
  
      #sidebar a {
        justify-content: center;
      }
  
      body {
        padding-left: 80px; /* reduced margin on small screens */
      }
    }
  </style>
 <script>
  window.onload = function() {
    // Log to check if the script is running
    console.log('Checking if user is logged in...');
    
    // Check if the user is logged in by verifying tokens in localStorage
    const accessToken = localStorage.getItem('access_token');
    const refreshToken = localStorage.getItem('refresh_token');
    
    // Log the tokens to make sure they're set correctly
    console.log('Access Token:', accessToken);
    console.log('Refresh Token:', refreshToken);
    
    // If either token is missing, redirect to login page
    if (!accessToken || !refreshToken) {
      console.log('Tokens not found, redirecting to login...');
      
      // Delay of 1 second before redirect to let the user see the message
      setTimeout(function() {
        window.location.href = '/login'; // Redirect to login page
      }, 1000);
    }
  }
</script>

  
  
  <!-- Sidebar Markup -->
  <div id="sidebar">
    <div class="sidebar-logo">
      <i class="fas fa-heartbeat"></i>
      <span>HealthTrack</span>
    </div>
  
    <div style="flex-grow: 1; display: flex; flex-direction: column; gap: 10px;">
      <a href="#"><i class="fas fa-home"></i><span>Dashboard</span></a>
      <a href="#"><i class="fas fa-heartbeat"></i><span>Health Data</span></a>
      <a href="#"><i class="fas fa-pills"></i><span>Medications</span></a>
      <a href="#"><i class="fas fa-calendar-alt"></i><span>Appointments</span></a>
      <a href="#"><i class="fas fa-file-medical"></i><span>Records</span></a>
      <a href="#"><i class="fas fa-chart-line"></i><span>Analytics</span></a>
    </div>
  
    <div style="display: flex; flex-direction: column; gap: 10px;">
      <a href="#"><i class="fas fa-bell"></i><span>Reminders</span></a>
      <a href="#"><i class="fas fa-cog"></i><span>Settings</span></a>
     <!-- Anchor link to open account modal -->
<a href="javascript:void(0);" onclick="openAccountModal()">
  <i class="fas fa-user"></i><span>Account</span>
</a>

    </div>
  </div>
  <style>
    /* Hide sidebar below 1200px (Bootstrap's lg breakpoint is 992px) */
    @media (max-width: 1199px) {
      #sidebar {
        display: none !important;
      }
    }
  </style>
  
  

  <!-- Main Content -->
  <div class="main-content" style="margin-top: 10px; background-color: transparent;">


    <!-- Topbar -->
    <div class="topbar" style="border-radius: 16px; background-color: #333333; padding: 10px; margin: 0 20px 20px 20px;">
      <div class="topbar-left">
       
        <div style="padding: 20px; text-align: center;">
          <h1 style="
            color: #32CD32; /* Darker green */
            font-size: 26px;
            font-weight: bold;
            text-shadow: 0 0 5px #228B22, 0 0 10px #228B22; /* Darker green glow */
            margin: 0;
            white-space: nowrap;
          ">
            <i class="fas fa-heartbeat" style="margin-right: 10px;"></i>HealthTrack
          </h1>
        </div>
        <style>
          .topbar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 70px; /* or your current height */
  z-index: 1000;
  background-color: inherit; /* Keeps your custom color */
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 15px;
}

/* Ensures content and sidebar don't go under the topbar */
#sidebar {
  margin-top: 70px; /* Pushes below topbar */
}

.main-content {
  margin-top: 80px; /* Prevents content from sliding under topbar */
}

        </style>
        
      </div>
      <div class="topbar-right">
        
        <div class="user-profile">
          <div class="user-avatar">
            <i class="fas fa-user"></i>
          </div>
        
          <style>
            .user-avatar {
              width: 60px;
              height: 60px;
              border-radius: 50%;
              background-color: #e0e0e0; /* light grey background */
              display: flex;
              justify-content: center;
              align-items: center;
              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* soft shadow */
            }
        
            .user-avatar i {
              font-size: 28px;
              color: #555; /* dark grey icon */
            }
          </style>
        
        
          
          
          <div class="user-dropdown">
            <span class="dropdown-item" onclick="openAccountModal()">
              <i class="fas fa-user-circle dropdown-icon"></i>
              <span>My Account</span>
            </span>
            

            
        

<a href="#" class="dropdown-item" data-bs-toggle="modal" data-bs-target="#aiAssistantModal">
  <i class="fas fa-question-circle dropdown-icon"></i>
  <span>Help</span>
</a>

<div class="dropdown-divider"></div>

<a href="https://hetrack.netlify.app/login" id="login-link" class="dropdown-item"> 
  <i class="fas fa-sign-in-alt dropdown-icon"></i>
  <span>Login</span>
</a>

<a href="https://hetrack.netlify.app/register" id="register-link" class="dropdown-item"> 
  <i class="fas fa-user-plus dropdown-icon"></i>
  <span>Register</span>
</a>

<a href="#" id="logout-btn" class="dropdown-item" style="display: none;"> 
  <i class="fas fa-sign-out-alt dropdown-icon"></i>
  <span>Logout</span>
</a>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const accessToken = localStorage.getItem('access_token');
    
    const loginLink = document.getElementById('login-link');
    const registerLink = document.getElementById('register-link');
    const logoutBtn = document.getElementById('logout-btn');

    if (accessToken) {
      // User is logged in
      loginLink.style.display = 'none';
      registerLink.style.display = 'none';
      logoutBtn.style.display = 'block';
    } else {
      // User is not logged in
      loginLink.style.display = 'block';
      registerLink.style.display = 'block';
      logoutBtn.style.display = 'none';
    }

    // Handle logout
    logoutBtn.addEventListener('click', (e) => {
      e.preventDefault();
      localStorage.removeItem('access_token');
      localStorage.removeItem('refresh_token');
      window.location.href = '/login'; // Redirect to login after logout
    });
  });
</script>


<!-- Notification container -->
<div id="notification" class="notification"></div>

<style>
  /* Sliding notification styling */
  .notification {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 15px;
    background-color: #28a745;
    color: white;
    border-radius: 5px;
    font-size: 16px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
    z-index: 9999;
  }

  .notification.show {
    opacity: 1;
    visibility: visible;
  }

  .notification.error {
    background-color: #dc3545;
  }
</style>






  

        </div>
      </div>
    </div>

    <!-- Dashboard Content -->
    <div class="dashboard" id="dashboardContent" style="background-color: #333333; margin-top: 0; margin-bottom: 20px; border-radius: 16px;">

     
<!-- Font Awesome CDN -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

<style>
  @media (min-width: 768px) {
    .health-grid {
      display: flex !important;
      flex-direction: row !important;
      justify-content: space-between;
      gap: 20px;
    }
    .health-card {
      width: 100% !important;
    }
  }
</style>
<!-- Health Summary -->
<div class="container mt-4 mb-5" style="font-family: Georgia, serif; font-size: 18px;">
  <div class="row justify-content-center">
    <div class="col-lg-10 col-md-11 col-sm-12" style="background: #ffffff; border-radius: 16px; padding: 20px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25); margin: auto;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <div style="font-size: 24px; font-weight: 800; color: #1a1a1a;">
          <i class="fas fa-notes-medical" style="margin-right: 8px; color: #e6d3b3;"></i>Health Summary
        </div>
        <button class="btn btn-sm btn-outline-secondary text-dark" data-bs-toggle="modal" data-bs-target="#updateHealthModal">
          <i class="fa fa-edit"></i> Update Summary
        </button>
      </div>

      <div class="health-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
        <!-- Overall Health -->
        <div class="health-card" style="background: #ffffff; border-radius: 12px; padding: 16px; text-align: center; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);">
          <div style="font-size: 16px; font-weight: 700; color: #1a1a1a; margin-bottom: 8px;">Overall Health</div>
          <i class="fas fa-heart-circle-check" style="font-size: 28px; margin: 10px 0; color: #e6d3b3;"></i>
          <div id="overall-health" style="font-size: 18px; font-weight: 800; color: #1a1a1a; margin-bottom: 8px;">Loading...</div>
          <div id="last-checked" style="font-size: 14px; font-weight: 600; color: #666;">Last updated: -</div>
        </div>

        <!-- Medication Adherence -->
        <div class="health-card" style="background: #ffffff; border-radius: 12px; padding: 16px; text-align: center; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);">
          <div style="font-size: 16px; font-weight: 700; color: #1a1a1a; margin-bottom: 8px;">Medication Adherence</div>
          <div style="position: relative; width: 80px; height: 80px; margin: 15px auto;">
            <svg id="medication-chart" viewBox="0 0 36 36" style="transform: rotate(-90deg); width: 100%; height: 100%;">
              <path fill="none" stroke="#e0e0e0" stroke-width="3" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
              <path id="medication-progress" fill="none" stroke="#e6d3b3" stroke-width="3" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
            </svg>
            <div id="medication-percent" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 18px; font-weight: bold; color: #1a1a1a;">0%</div>
          </div>
          <div id="medication-timeframe" style="font-size: 14px; font-weight: 600; color: #666;">This week</div>
        </div>

        <!-- Activity Level -->
        <div class="health-card" style="background: #ffffff; border-radius: 12px; padding: 16px; text-align: center; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);">
          <div style="font-size: 16px; font-weight: 700; color: #1a1a1a; margin-bottom: 8px;">Activity Level</div>
          <div style="position: relative; width: 60px; height: 60px; margin: 10px auto;">
            <i class="fas fa-circle-notch fa-spin" style="font-size: 60px; color: #e6d3b3;"></i>
            <i class="fas fa-running" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 22px; color: #1a1a1a;"></i>
          </div>
          <div id="activity-level" style="font-size: 18px; font-weight: 800; color: #1a1a1a; margin-bottom: 8px;">0%</div>
          <div style="font-size: 14px; font-weight: 600; color: #666;">Weekly goal</div>
        </div>

        <!-- Next Appointment -->
        <div class="health-card" style="background: #ffffff; border-radius: 12px; padding: 16px; text-align: center; box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);">
          <div style="font-size: 16px; font-weight: 700; color: #1a1a1a; margin-bottom: 8px;">Next Appointment</div>
          <i class="fas fa-calendar-alt" style="font-size: 28px; margin: 10px 0; color: #e6d3b3;"></i>
          <div id="next-appointment-date" style="font-size: 18px; font-weight: 800; color: #1a1a1a; margin-bottom: 8px;">Loading...</div>
          <div id="next-appointment-days" style="font-size: 14px; font-weight: 600; color: #666;">-</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal for updating health summary -->
<div class="modal fade" id="updateHealthModal" tabindex="-1" aria-labelledby="updateHealthModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form class="modal-content" id="health-summary-form">
      <div class="modal-header">
        <h5 class="modal-title" id="updateHealthModalLabel">Update Health Summary</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="this.blur()"></button>

      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="overallHealthInput" class="form-label">Overall Health</label>
          <input type="text" class="form-control" id="overallHealthInput" required>
        </div>
        <div class="mb-3">
          <label for="medicationInput" class="form-label">Medication Adherence (%)</label>
          <input type="number" class="form-control" id="medicationInput" min="0" max="100" required>
        </div>
        <div class="mb-3">
          <label for="activityInput" class="form-label">Activity Level (%)</label>
          <input type="number" class="form-control" id="activityInput" min="0" max="100" required>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" onclick="this.blur()">Cancel</button>
        <button type="submit" class="btn btn-primary" onclick="this.blur()">Save changes</button>

      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const accessToken = localStorage.getItem('access_token');
    if (!accessToken) {
      console.error('No access token found');
      showErrorMessage('Please login to view health data');
      return;
    }
  
    // Toast notification functions
    function showToast(message, isSuccess = true) {
      const toast = document.createElement('div');
      toast.style.position = 'fixed';
      toast.style.top = '20px';
      toast.style.right = '20px';
      toast.style.padding = '12px 24px';
      toast.style.backgroundColor = isSuccess ? '#4CAF50' : '#f44336';
      toast.style.color = 'white';
      toast.style.borderRadius = '4px';
      toast.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
      toast.style.zIndex = '1000';
      toast.style.animation = 'fadein 0.5s, fadeout 0.5s 2.5s';
      toast.textContent = message;
      document.body.appendChild(toast);
  
      setTimeout(() => {
        document.body.removeChild(toast);
      }, 3000);
    }
  
    function showErrorMessage(message) {
      document.getElementById('overall-health').textContent = 'Error';
      document.getElementById('next-appointment-date').textContent = 'Error';
      document.getElementById('next-appointment-days').textContent = message;
    }
  
    // Fetch and display the most recent health data
    function fetchHealthData() {
      // Show loading states
      document.getElementById('overall-health').textContent = 'Loading...';
      document.getElementById('next-appointment-date').textContent = 'Loading...';
  
      // Fetch health summary data
      fetch('https://healthtrack.pythonanywhere.com/api/health-summary/', {
        headers: { 'Authorization': `Bearer ${accessToken}` }
      })
      .then(res => {
        if (!res.ok) throw new Error('Failed to fetch health data');
        return res.json();
      })
      .then(data => {
        // Get the most recent entry (assuming API returns array sorted by date)
        const latestData = Array.isArray(data) ? 
          data.sort((a, b) => new Date(b.last_updated) - new Date(a.last_updated))[0] : 
          data;
  
        if (latestData) {
          document.getElementById('overall-health').textContent = latestData.overall_health || 'Good';
          document.getElementById('last-checked').textContent = `Last updated: ${new Date(latestData.last_updated).toLocaleDateString()}`;
          document.getElementById('medication-percent').textContent = `${latestData.medication_adherence || 0}%`;
          document.getElementById('medication-progress').setAttribute('stroke-dasharray', `${latestData.medication_adherence || 0}, 100`);
          document.getElementById('activity-level').textContent = `${latestData.activity_level || 0}%`;
          
          // Pre-fill form with current values
          document.getElementById('overallHealthInput').value = latestData.overall_health || '';
          document.getElementById('medicationInput').value = latestData.medication_adherence || 0;
          document.getElementById('activityInput').value = latestData.activity_level || 0;
        }
        // Removed the else block that showed "No health data available" toast
      })
      .catch(error => {
        console.error('Error fetching health data:', error);
        showToast('Failed to load health data', false);
      });
  
      // Fetch upcoming appointments
      fetch('https://healthtrack.pythonanywhere.com/api/appointments/', {
        headers: { 'Authorization': `Bearer ${accessToken}` }
      })
      .then(res => {
        if (!res.ok) throw new Error('Failed to fetch appointments');
        return res.json();
      })
      .then(appointments => {
        // Filter out past appointments and get the most recent one
        const now = new Date();
        const upcomingAppointments = appointments.filter(appt => 
          new Date(appt.appointment_date) > now
        );
  
        // Sort by date (soonest first)
        upcomingAppointments.sort((a, b) => 
          new Date(a.appointment_date) - new Date(b.appointment_date)
        );
  
        if (upcomingAppointments.length > 0) {
          const nextAppt = upcomingAppointments[0];
          const apptDate = new Date(nextAppt.appointment_date);
          const daysLeft = Math.ceil((apptDate - now) / (1000 * 60 * 60 * 24));
          
          document.getElementById('next-appointment-date').textContent = 
            apptDate.toLocaleDateString('en-US', { 
              weekday: 'short', 
              month: 'short', 
              day: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            });
            
          document.getElementById('next-appointment-days').textContent = 
            daysLeft === 0 ? 'Today' : `${daysLeft} day${daysLeft !== 1 ? 's' : ''} from now`;
        } else {
          document.getElementById('next-appointment-date').textContent = 'No upcoming appointments';
          document.getElementById('next-appointment-days').textContent = '';
        }
      })
      .catch(error => {
        console.error('Error fetching appointments:', error);
        document.getElementById('next-appointment-date').textContent = 'Error loading appointments';
        document.getElementById('next-appointment-days').textContent = '';
      });
    }
  
    // Submit update for health summary
    document.getElementById('health-summary-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const overall = document.getElementById('overallHealthInput').value;
      const medication = parseInt(document.getElementById('medicationInput').value);
      const activity = parseInt(document.getElementById('activityInput').value);
  
      fetch('https://healthtrack.pythonanywhere.com/api/health-summary/', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${accessToken}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          overall_health: overall,
          medication_adherence: medication,
          activity_level: activity
        })
      })
      .then(response => {
        if (!response.ok) throw new Error('Failed to update health summary');
        return response.json();
      })
      .then(() => {
        showToast('Health summary updated successfully!');
        
        // Get the modal instance
        const modalEl = document.getElementById('updateHealthModal');
        const modal = bootstrap.Modal.getInstance(modalEl);
        
        // Hide the modal
        modal.hide();
        
        // Wait for the modal to finish hiding (Bootstrap 5 uses promises)
        modal._element.addEventListener('hidden.bs.modal', function() {
          // Clean up any remaining backdrop
          const backdrops = document.querySelectorAll('.modal-backdrop');
          backdrops.forEach(backdrop => backdrop.remove());
          
          // Reset body styles
          document.body.style.overflow = 'auto';
          document.body.style.paddingRight = '0';
          document.body.classList.remove('modal-open');
        });
  
        fetchHealthData(); // Refresh data
      })
      .catch(error => {
        console.error('Update failed:', error);
        showToast('Update failed: ' + error.message, false);
      });
    });
  
    // Initial data fetch
    fetchHealthData();
  });
  </script>


<style>
@keyframes fadein {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes fadeout {
  from { opacity: 1; }
  to { opacity: 0; }
}

.health-card {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.health-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 28px rgba(0, 0, 0, 0.2) !important;
}

#medication-progress {
  transition: stroke-dasharray 1s ease;
}
</style>



<div class="row justify-content-center" style="margin-bottom: 80px;">
  <div class="col-12 col-lg-10 col-xl-8">
    <div class="card" style="background-color: #fefaf4; border: none; border-radius: 20px; box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);">
      <div class="card-body p-4 p-md-5">
        <h3 class="text-center mb-5" style="font-family: 'Georgia', serif; font-weight: bold; color: #333; font-size: 1.8rem;">Daily Health Check-In</h3>
        
        <form id="checkinForm" class="mx-auto" style="max-width: 800px;">
          <!-- Name Card - Removed since we'll get user info from token -->
          
          <!-- Mood Card -->
          <div class="mb-4 p-4" style="background-color: #fffaf1; border-radius: 14px; box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);">
            <label class="form-label mb-3" style="font-weight: 600; color: #444; font-size: 1rem;">Today's Mood</label>
            <div class="d-flex justify-content-around px-2">
              <div class="text-center mood-option" data-value="1">
                <i class="fas fa-frown fa-2x mb-2" style="color: #e74c3c;"></i>
                <div style="font-size: 0.85rem; color: #555;">Terrible</div>
              </div>
              <div class="text-center mood-option" data-value="2">
                <i class="fas fa-meh fa-2x mb-2" style="color: #f39c12;"></i>
                <div style="font-size: 0.85rem; color: #555;">Okay</div>
              </div>
              <div class="text-center mood-option" data-value="3">
                <i class="fas fa-smile fa-2x mb-2" style="color: #2ecc71;"></i>
                <div style="font-size: 0.85rem; color: #555;">Good</div>
              </div>
              <div class="text-center mood-option" data-value="4">
                <i class="fas fa-laugh-beam fa-2x mb-2" style="color: #27ae60;"></i>
                <div style="font-size: 0.85rem; color: #555;">Great</div>
              </div>
            </div>
            <input type="hidden" id="moodValue" name="mood" value="">
          </div>

          <!-- Energy Card -->
          <div class="mb-4 p-4" style="background-color: #fffaf1; border-radius: 14px; box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);">
            <label for="energy" class="form-label mb-3" style="font-weight: 600; color: #444; font-size: 1rem;">Energy Level</label>
            <div class="px-3 mb-2">
              <input type="range" class="form-range" min="1" max="10" id="energy" oninput="updateEnergyValue(this.value)" 
                style="accent-color: #8aa398; height: 8px;">
            </div>
            <div class="d-flex justify-content-between align-items-center">
              <small style="font-size: 0.9rem; color: #555;">Low Energy</small>
              <span id="energyValue" class="fw-bold" style="font-size: 1.1rem; color: #8aa398;">5</span>
              <small style="font-size: 0.9rem; color: #555;">High Energy</small>
            </div>
          </div>

          <!-- Symptoms Card -->
          <div class="mb-5 p-4" style="background-color: #fffaf1; border-radius: 14px; box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);">
            <label for="symptoms" class="form-label mb-2" style="font-weight: 600; color: #444; font-size: 1rem;">Symptoms or Notes</label>
            <textarea class="form-control form-control-lg" id="symptoms" rows="3" placeholder="Any symptoms or notes for today..."
              style="font-size: 1rem; padding: 12px; background-color: #fff; border: 1px solid #ddd; border-radius: 10px;"></textarea>
          </div>

          <!-- Submit Button -->
          <div class="text-center">
            <button class="btn px-5 py-3" type="submit"
              style="font-size: 1.1rem; background-color: #8aa398; border: none; border-radius: 12px; color: white; box-shadow: 0 4px 15px rgba(138, 163, 152, 0.4); transition: all 0.3s;">
              <i class="fas fa-arrow-right me-2"></i>Submit Check-In
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<script>
 document.addEventListener('DOMContentLoaded', function() {
    // Get elements
    const moodOptions = document.querySelectorAll('.mood-option');
    const moodValueInput = document.getElementById('moodValue');
    const energySlider = document.getElementById('energy');
    const energyValueDisplay = document.getElementById('energyValue');
    const symptomsTextarea = document.getElementById('symptoms');
    const checkinForm = document.getElementById('checkinForm');
    
    // Create welcome message element
    const welcomeMessage = document.createElement('div');
    welcomeMessage.className = 'welcome-message';
    welcomeMessage.textContent = "You have not checked in today";
    checkinForm.insertBefore(welcomeMessage, checkinForm.firstChild);
    
    // Mood selection
    moodOptions.forEach(option => {
        option.addEventListener('click', function() {
            // Remove active class from all options
            moodOptions.forEach(opt => opt.classList.remove('active'));
            // Add active class to selected option
            this.classList.add('active');
            // Update hidden input value
            moodValueInput.value = this.getAttribute('data-value');
            // Update welcome message
            updateWelcomeMessage();
        });
    });

    // Notification utility
    function showNotification(message, isError = false) {
        let notification = document.getElementById('notification');
        if (!notification) {
            notification = document.createElement('div');
            notification.id = 'notification';
            notification.className = 'notification';
            document.body.appendChild(notification);
        }

        notification.textContent = message;
        notification.classList.add('show');
        if (isError) {
            notification.classList.add('error');
        } else {
            notification.classList.remove('error');
        }

        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }

    // Energy slider update
    window.updateEnergyValue = function(value) {
        energyValueDisplay.textContent = value;
        updateWelcomeMessage();
    };
    
    // Format date to YYYY-MM-DD for comparison
    function formatDate(date) {
        const d = new Date(date);
        return d.toISOString().split('T')[0];
    }
    
    // Check if a date is today
    function isToday(dateString) {
        const today = new Date();
        const checkDate = new Date(dateString);
        return formatDate(today) === formatDate(checkDate);
    }
    
    // Update welcome message based on form state
    function updateWelcomeMessage() {
        if (moodValueInput.value) {
            welcomeMessage.textContent = "Complete your daily check-in";
            welcomeMessage.style.display = "block";
        } else {
            welcomeMessage.textContent = "You have not checked in today";
            welcomeMessage.style.display = "block";
        }
    }
    
    // Reset form to default values
    function resetForm() {
        moodValueInput.value = '';
        moodOptions.forEach(opt => opt.classList.remove('active'));
        energySlider.value = 5;
        energyValueDisplay.textContent = '5';
        symptomsTextarea.value = '';
        updateWelcomeMessage();
    }
    
    // Hide welcome message after successful submission
    function hideWelcomeMessage() {
        welcomeMessage.style.display = "none";
    }
    
    // Fetch latest check-in data
    async function fetchLatestCheckIn() {
        try {
            const token = localStorage.getItem('access_token');
            if (!token) {
                resetForm();
                return;
            }
            
            const response = await fetch('https://healthtrack.pythonanywhere.com/api/daily-checkins/', {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });
            
            if (!response.ok) {
                throw new Error('Failed to fetch check-in data');
            }
            
            const data = await response.json();
            
            if (data.length > 0) {
                const latestCheckIn = data[0];
                const checkInDate = latestCheckIn.date || latestCheckIn.created_at;
                
                // Only pre-fill if the check-in was today
                if (checkInDate && isToday(checkInDate)) {
                    if (latestCheckIn.mood) {
                        moodValueInput.value = latestCheckIn.mood;
                        document.querySelector(`.mood-option[data-value="${latestCheckIn.mood}"]`)?.classList.add('active');
                    }
                    if (latestCheckIn.energy_level) {
                        energySlider.value = latestCheckIn.energy_level;
                        energyValueDisplay.textContent = latestCheckIn.energy_level;
                    }
                    if (latestCheckIn.symptoms) {
                        symptomsTextarea.value = latestCheckIn.symptoms;
                    }
                    hideWelcomeMessage();
                } else {
                    // It's a new day, reset the form
                    resetForm();
                }
            } else {
                // No check-ins at all
                resetForm();
            }
        } catch (error) {
            console.error('Error fetching check-in data:', error);
            resetForm();
        }
    }
    
    // Form submission
    checkinForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        if (!moodValueInput.value) {
            showNotification('Please select your mood', true);
            return;
        }
        
        const token = localStorage.getItem('access_token');
        const formData = {
            mood: moodValueInput.value,
            energy_level: energySlider.value,
            symptoms: symptomsTextarea.value
        };
        
        try {
            const response = await fetch('https://healthtrack.pythonanywhere.com/api/daily-checkins/', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            });
            
            if (!response.ok) {
                throw new Error('Failed to submit check-in');
            }
            
            await response.json();
            showNotification('Check-in submitted successfully!');
            hideWelcomeMessage();
            
        } catch (error) {
            console.error('Error submitting check-in:', error);
            showNotification('Failed to submit check-in. Please try again.', true);
        }
    });
    
    // Initial data fetch
    fetchLatestCheckIn();

    // Listen for textarea changes
    symptomsTextarea.addEventListener('input', updateWelcomeMessage);

    // Mood CSS style
    const style = document.createElement('style');
    style.textContent = `
        .mood-option.active {
            transform: scale(1.1);
            transition: transform 0.2s;
        }
        .mood-option.active i {
            filter: drop-shadow(0 0 5px rgba(0,0,0,0.2));
        }
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 20px;
            background-color: #28a745;
            color: white;
            border-radius: 5px;
            font-size: 16px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
            z-index: 9999;
        }
        .notification.show {
            opacity: 1;
            visibility: visible;
        }
        .notification.error {
            background-color: #dc3545;
        }
        
        .welcome-message {
            text-align: center;
            margin-bottom: 20px;
            font-style: italic;
            color: #666;
        }
    `;
    document.head.appendChild(style);
});
  </script>
  
  <script>
  // Backup updateEnergyValue + fallback mood click
  function updateEnergyValue(val) {
      document.getElementById('energyValue').textContent = val;
  }
  
  // Redundant mood fallback if needed
  document.querySelectorAll('.mood-option').forEach(option => {
      option.addEventListener('click', function() {
          document.querySelectorAll('.mood-option').forEach(opt => {
              opt.style.opacity = '0.6';
              opt.style.transform = 'scale(1)';
          });
          this.style.opacity = '1';
          this.style.transform = 'scale(1.1)';
          document.getElementById('moodValue').value = this.getAttribute('data-value');
      });
  });
  </script>
  


<style>
  .mood-option {
    cursor: pointer;
    transition: all 0.2s ease;
    opacity: 0.6;
    padding: 10px;
    border-radius: 10px;
  }
  
  .mood-option:hover {
    opacity: 0.8;
    background-color: rgba(255, 255, 255, 0.5);
  }
  
  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(138, 163, 152, 0.5) !important;
  }
  
  input[type="range"]::-webkit-slider-thumb {
    width: 20px;
    height: 20px;
  }
</style>
<!-- Chronic Diseases & Medications - Single Row Layout -->
<div class="row">
  <!-- Chronic Conditions Column -->
  <div class="col-lg-6" style="margin-bottom: 40px;">
    <div class="p-3 h-100" style="background-color: #fdfbf6; border-radius: 16px; box-shadow: 0 6px 24px rgba(0, 0, 0, 0.12);">
      <h5 class="mb-4 fw-bold" style="font-family: 'Georgia', serif; color: #1c1c1c;">
        <i class="fas fa-notes-medical me-2 text-danger"></i>Chronic Conditions
      </h5>

      <!-- Conditions Container (will be populated dynamically) -->
      <div id="conditionsContainer">
        <!-- Conditions will be added here by JavaScript -->
      </div>

      <!-- Add Condition Button at Bottom -->
      <div class="text-end">
        <button id="openConditionModal" class="btn" style="background-color: #f5e8e0; color: #2a2a2a; font-weight: 600; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); border: 1px solid #d4c4b8;">
          <i class="fas fa-plus-circle me-2"></i>Add Condition
        </button>
      </div>
    </div>
  </div>

  <!-- Medications Column -->
  <div class="col-lg-6" style="margin-bottom: 40px;">
    <div class="p-3 h-100" style="background-color: #fdfbf6; border-radius: 16px; box-shadow: 0 6px 24px rgba(0, 0, 0, 0.12);">
      <h5 class="mb-4 fw-bold" style="font-family: 'Georgia', serif; color: #1c1c1c;">
        <i class="fas fa-pills me-2" style="color: #3b6b57;"></i>Medication Reminders
      </h5>

      <!-- Medications Container (will be populated dynamically) -->
      <div id="medicationsContainer">
        <!-- Medications will be added here by JavaScript -->
      </div>

      <!-- Add Medication Button -->
      <div class="text-end">
        <button id="openMedicationModal" class="btn" style="background-color: #f5e8e0; color: #2a2a2a; font-weight: 600; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); border: 1px solid #d4c4b8;">
          <i class="fas fa-pills me-2"></i> Add Medication
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Condition Modal -->
<div id="customConditionModal" class="custom-modal">
  <div class="custom-modal-content">
    <span id="closeConditionModal" class="close">&times;</span>
    <h5><i class="fas fa-diagnoses me-2"></i>Add New Condition</h5>
    <form id="conditionForm">
      <div class="mb-3">
        <label for="conditionName" class="form-label"><i class="fas fa-disease me-2"></i>Condition Name</label>
        <input type="text" class="form-control" id="conditionName" placeholder="e.g., Diabetes Type 2" required>
      </div>
      <div class="mb-3">
        <label for="diagnosisDate" class="form-label"><i class="fas fa-calendar-alt me-2"></i>Diagnosis Date</label>
        <input type="date" class="form-control" id="diagnosisDate" required>
      </div>
      <div class="mb-3">
        <label for="conditionStatus" class="form-label"><i class="fas fa-heartbeat me-2"></i>Status</label>
        <select class="form-select" id="conditionStatus" required>
          <option value="active">Active</option>
          <option value="controlled">Controlled</option>
          <option value="resolved">Resolved</option>
          <option value="improving">Improving</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="conditionNotes" class="form-label"><i class="fas fa-notes-medical me-2"></i>Additional Notes</label>
        <textarea class="form-control" id="conditionNotes" rows="3" placeholder="Any additional information about this condition"></textarea>
      </div>
      <div class="text-end">
        <button type="button" class="btn btn-outline-secondary me-2" id="cancelConditionBtn">
          <i class="fas fa-times me-1"></i> Cancel
        </button>
        <button type="submit" class="btn" style="background-color: #d4a373; color: #2a2a2a; font-weight: 600;">
          <i class="fas fa-save me-1"></i> Save Condition
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Medication Modal -->
<div id="customMedicationModal" class="custom-modal">
  <div class="custom-modal-content">
    <span id="closeMedicationModal" class="close">&times;</span>
    <h5><i class="fas fa-prescription-bottle-alt me-2"></i>Add Medication</h5>
    <form id="medicationForm">
      <div class="mb-3">
        <label for="medicationName" class="form-label"><i class="fas fa-medkit me-2"></i>Medication Name</label>
        <input type="text" class="form-control" id="medicationName" placeholder="Enter medication name" required>
      </div>
      <div class="mb-3">
        <label for="dosage" class="form-label"><i class="fas fa-syringe me-2"></i>Dosage</label>
        <input type="text" class="form-control" id="dosage" placeholder="e.g., 500mg" required>
      </div>
      <div class="mb-3">
        <label for="schedule" class="form-label"><i class="fas fa-clock me-2"></i>Schedule</label>
        <input type="text" class="form-control" id="schedule" placeholder="e.g., Twice a day" required>
      </div>
      <div class="mb-3">
        <label for="reminderTime" class="form-label"><i class="fas fa-bell me-2"></i>Reminder Time</label>
        <input type="time" class="form-control" id="reminderTime">
      </div>
      <div class="mb-3">
        <label for="hasReminder" class="form-check-label">
          <input type="checkbox" class="form-check-input" id="hasReminder"> Enable Reminder
        </label>
      </div>
      <div class="mb-3">
        <label for="condition" class="form-label"><i class="fas fa-disease me-2"></i>For Condition (optional)</label>
        <select class="form-select" id="condition">
          <option value="">Select condition</option>
          <!-- Conditions will be populated here -->
        </select>
      </div>
      <div class="mb-3">
        <label for="medicationNotes" class="form-label"><i class="fas fa-notes-medical me-2"></i>Notes</label>
        <textarea class="form-control" id="medicationNotes" rows="3" placeholder="Any additional notes"></textarea>
      </div>
      <div class="text-end">
        <button type="button" class="btn btn-outline-secondary me-2" id="cancelMedicationBtn">
          <i class="fas fa-times me-1"></i> Cancel
        </button>
        <button type="submit" class="btn" style="background-color: #d4a373; color: #2a2a2a; font-weight: 600;">
          <i class="fas fa-save me-1"></i> Save
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal CSS -->
<style>
  .custom-modal {
    display: none;
    position: fixed;
    z-index: 9999;
    padding-top: 100px;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.5);
  }

  .custom-modal-content {
    background-color: #f5e8e0;
    margin: auto;
    padding: 25px;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    position: relative;
    color: #2a2a2a;
    border: 1px solid #d4c4b8;
  }

  .close {
    color: #7a6b5f;
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }

  .close:hover {
    color: #2a2a2a;
  }

  .form-control, .form-select {
    background-color: #fffcf9;
    border: 1px solid #d4c4b8;
    color: #2a2a2a;
  }

  .form-control:focus, .form-select:focus {
    background-color: #fffcf9;
    border-color: #b8a99d;
    box-shadow: 0 0 0 0.25rem rgba(180, 160, 140, 0.25);
  }

  .form-label {
    font-weight: 500;
    color: #3a3a3a;
  }

  h5 {
    color: #3a3a3a;
    font-weight: 600;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid #d4c4b8;
  }

  textarea {
    resize: vertical;
    min-height: 100px;
  }
  
  .delete-btn {
    color: #dc3545;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 16px;
    transition: color 0.2s;
  }
  
  .delete-btn:hover {
    color: #b02a37;
  }
  
  /* Confirm Toast Styles */
  .confirm-toast {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    z-index: 10000;
    max-width: 90%;
    width: 400px;
    text-align: center;
  }
  
  .confirm-toast p {
    margin-bottom: 20px;
    font-size: 16px;
    color: #333;
  }
  
  .confirm-toast-buttons {
    display: flex;
    justify-content: center;
    gap: 10px;
  }
  
  .confirm-toast-btn {
    padding: 8px 20px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.2s;
  }
  
  .confirm-toast-confirm {
    background-color: #dc3545;
    color: white;
  }
  
  .confirm-toast-confirm:hover {
    background-color: #c82333;
  }
  
  .confirm-toast-cancel {
    background-color: #6c757d;
    color: white;
  }
  
  .confirm-toast-cancel:hover {
    background-color: #5a6268;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
      // Condition Management
      const conditionsContainer = document.getElementById('conditionsContainer');
      const openConditionBtn = document.getElementById('openConditionModal');
      const closeConditionBtn = document.getElementById('closeConditionModal');
      const cancelConditionBtn = document.getElementById('cancelConditionBtn');
      const conditionModal = document.getElementById('customConditionModal');
      const conditionForm = document.getElementById('conditionForm');
      
      // Medication Management
      const medicationsContainer = document.getElementById('medicationsContainer');
      const openMedicationBtn = document.getElementById('openMedicationModal');
      const closeMedicationBtn = document.getElementById('closeMedicationModal');
      const cancelMedicationBtn = document.getElementById('cancelMedicationBtn');
      const medicationModal = document.getElementById('customMedicationModal');
      const medicationForm = document.getElementById('medicationForm');
      const conditionSelect = document.getElementById('condition');
  
      // Create toast notification function
      function showToast(message, isSuccess = true) {
          const toast = document.createElement('div');
          toast.style.position = 'fixed';
          toast.style.top = '50%';
          toast.style.left = '50%';
          toast.style.transform = 'translate(-50%, -50%)';
          toast.style.padding = '12px 24px';
          toast.style.backgroundColor = isSuccess ? '#4CAF50' : '#f44336';
          toast.style.color = 'white';
          toast.style.borderRadius = '4px';
          toast.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
          toast.style.zIndex = '1000';
          toast.style.animation = 'fadein 0.5s, fadeout 0.5s 2.5s';
          toast.textContent = message;

          document.body.appendChild(toast);

          setTimeout(() => {
              document.body.removeChild(toast);
          }, 3000);
      }
      
      // Create confirm toast function
      function showConfirmToast(message, confirmCallback) {
          const toast = document.createElement('div');
          toast.className = 'confirm-toast';
          toast.innerHTML = `
              <p>${message}</p>
              <div class="confirm-toast-buttons">
                  <button class="confirm-toast-btn confirm-toast-cancel">Cancel</button>
                  <button class="confirm-toast-btn confirm-toast-confirm">Confirm</button>
              </div>
          `;
          
          document.body.appendChild(toast);
          
          // Add event listeners
          const cancelBtn = toast.querySelector('.confirm-toast-cancel');
          const confirmBtn = toast.querySelector('.confirm-toast-confirm');
          
          const removeToast = () => {
              document.body.removeChild(toast);
          };
          
          cancelBtn.addEventListener('click', () => {
              removeToast();
          });
          
          confirmBtn.addEventListener('click', () => {
              confirmCallback();
              removeToast();
          });
      }
  
      // Add CSS for toast animation
      const style = document.createElement('style');
      style.textContent = `
          @keyframes fadein {
              from {opacity: 0;}
              to {opacity: 1;}
          }
          @keyframes fadeout {
              from {opacity: 1;}
              to {opacity: 0;}
          }
      `;
      document.head.appendChild(style);
  
      // Modal control functions
      function openModal(modal) {
          modal.style.display = 'block';
      }
      
      function closeModal(modal) {
          modal.style.display = 'none';
          if (modal === conditionModal) conditionForm.reset();
          if (modal === medicationModal) medicationForm.reset();
      }
      
      // Modal event listeners
      openConditionBtn.addEventListener('click', () => openModal(conditionModal));
      closeConditionBtn.addEventListener('click', () => closeModal(conditionModal));
      cancelConditionBtn.addEventListener('click', () => closeModal(conditionModal));
      
      openMedicationBtn.addEventListener('click', () => openModal(medicationModal));
      closeMedicationBtn.addEventListener('click', () => closeModal(medicationModal));
      cancelMedicationBtn.addEventListener('click', () => closeModal(medicationModal));
      
      // Close modal when clicking outside
      window.addEventListener('click', function(event) {
          if (event.target === conditionModal) closeModal(conditionModal);
          if (event.target === medicationModal) closeModal(medicationModal);
      });
  
      // Status badge styling
      function getStatusBadgeStyle(status) {
          const styles = {
              'active': { bg: '#f9d7cf', text: '#912e23' },
              'controlled': { bg: '#ffe9ba', text: '#7a4e00' },
              'resolved': { bg: '#d4edda', text: '#155724' },
              'improving': { bg: '#c5ead5', text: '#1a6b42' }
          };
          return styles[status] || styles['active'];
      }
      
      // Icon and color mapping
      function getConditionIcon(conditionName) {
          const icons = {
              'diabetes': { icon: 'fa-tint', color: '#ec6a5e', bg: '#ffeeea' },
              'hypertension': { icon: 'fa-heartbeat', color: '#ec6a5e', bg: '#ffeeea' },
              'asthma': { icon: 'fa-lungs', color: '#e3a03f', bg: '#fff3e2' },
              'cholesterol': { icon: 'fa-pills', color: '#519a76', bg: '#e6f4eb' },
              'default': { icon: 'fa-disease', color: '#8e44ad', bg: '#f0e6f6' }
          };
          
          const lowerName = conditionName.toLowerCase();
          if (lowerName.includes('diabetes')) return icons['diabetes'];
          if (lowerName.includes('hypertension')) return icons['hypertension'];
          if (lowerName.includes('asthma')) return icons['asthma'];
          if (lowerName.includes('cholesterol')) return icons['cholesterol'];
          return icons['default'];
      }
      
      // Format date for display
      function formatDate(dateString) {
          const options = { year: 'numeric', month: 'long', day: 'numeric' };
          return new Date(dateString).toLocaleDateString(undefined, options);
      }
      
      // Create condition card HTML
      function createConditionCard(condition) {
          const iconInfo = getConditionIcon(condition.name);
          const statusStyle = getStatusBadgeStyle(condition.status);
          
          return `
              <div class="d-flex justify-content-between align-items-center p-3 mb-3" style="background-color: white; border-radius: 16px; box-shadow: 0 6px 18px rgba(0,0,0,0.15);" data-condition-id="${condition.id}">
                  <div class="d-flex align-items-center">
                      <div class="me-3" style="background-color: ${iconInfo.bg}; border-radius: 50%; padding: 10px;">
                          <i class="fas ${iconInfo.icon}" style="color: ${iconInfo.color}; font-size: 22px;"></i>
                      </div>
                      <div style="color: #1c1c1c;">
                          <div class="fw-bold" style="font-size: 18px;">${condition.name}</div>
                          <small>Diagnosed: ${formatDate(condition.diagnosis_date)}</small>
                      </div>
                  </div>
                  <div class="d-flex align-items-center">
                      <span class="badge rounded-pill me-2" style="background-color: ${statusStyle.bg}; color: ${statusStyle.text}; font-weight: 600;">
                          ${condition.status_display || condition.status.charAt(0).toUpperCase() + condition.status.slice(1)}
                      </span>
                      <button class="delete-btn delete-condition" data-id="${condition.id}" title="Delete condition">
                          <i class="fas fa-trash-alt"></i>
                      </button>
                  </div>
              </div>
          `;
      }
      
      // Icon selection based on medication type
      function getMedicationIcon(medName) {
          const lowerName = medName.toLowerCase();
          if (lowerName.includes('inhaler') || lowerName.includes('ventolin')) {
              return { icon: 'fa-inhaler', bg: '#e6f0f7' };
          }
          if (lowerName.includes('tablet') || lowerName.includes('tab')) {
              return { icon: 'fa-tablets', bg: '#f2f2f2' };
          }
          if (lowerName.includes('cream') || lowerName.includes('ointment')) {
              return { icon: 'fa-prescription-bottle', bg: '#f9f0df' };
          }
          return { icon: 'fa-capsules', bg: '#e1f4ef' };
      }
      
      // Format time for display
      function formatTime(timeString) {
          if (!timeString) return 'No reminder';
          const time = new Date(`2000-01-01T${timeString}`);
          return time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      }
      
      // Create medication card HTML
      function createMedicationCard(medication) {
          const iconInfo = getMedicationIcon(medication.name);
          const reminderTime = medication.reminder_time ? formatTime(medication.reminder_time) : 'No reminder';
          const hasReminder = medication.has_reminder && medication.reminder_time;
          
          return `
              <div class="mb-3" style="background-color: white; border-radius: 16px; box-shadow: 0 4px 16px rgba(0,0,0,0.12); padding: 16px;" data-medication-id="${medication.id}">
                  <div class="d-flex justify-content-between align-items-center">
                      <div class="d-flex align-items-center">
                          <div class="me-3" style="background-color: ${iconInfo.bg}; border-radius: 50%; padding: 10px;">
                              <i class="fas ${iconInfo.icon}" style="color: #3b6b57; font-size: 20px;"></i>
                          </div>
                          <div style="color: #1c1c1c;">
                              <div class="fw-bold" style="font-size: 18px;">${medication.name} ${medication.dosage}</div>
                              <div style="font-size: 14px;">${medication.condition_name ? 'For ' + medication.condition_name : ''}<br>${medication.schedule}</div>
                          </div>
                      </div>
                      <div class="d-flex align-items-center">
                          <div class="badge rounded-pill me-2" style="background-color: ${hasReminder ? '#d6eee7' : '#f2f2f2'}; color: #1c1c1c; font-weight: 600;">
                              <i class="fas fa-clock me-1"></i>${reminderTime}
                          </div>
                          <i class="fas ${hasReminder ? 'fa-bell' : 'fa-bell-slash'} me-2" style="color: #3b6b57;"></i>
                          <button class="delete-btn delete-medication" data-id="${medication.id}" title="Delete medication">
                              <i class="fas fa-trash-alt"></i>
                          </button>
                      </div>
                  </div>
              </div>
          `;
      }
      
      // Delete condition function
      async function deleteCondition(conditionId) {
          showConfirmToast('Are you sure you want to delete this condition?', async () => {
              try {
                  const token = localStorage.getItem('access_token');
                  const response = await fetch(`https://healthtrack.pythonanywhere.com/api/chronic-conditions/${conditionId}/`, {
                      method: 'DELETE',
                      headers: {
                          'Authorization': `Bearer ${token}`,
                          'Content-Type': 'application/json'
                      }
                  });
                  
                  if (!response.ok) {
                      throw new Error('Failed to delete condition');
                  }
                  
                  showToast('Condition deleted successfully!');
                  fetchConditions(); // Refresh the list
              } catch (error) {
                  console.error('Error deleting condition:', error);
                  showToast('Failed to delete condition', false);
              }
          });
      }
      
      // Delete medication function
      async function deleteMedication(medicationId) {
          showConfirmToast('Are you sure you want to delete this medication?', async () => {
              try {
                  const token = localStorage.getItem('access_token');
                  const response = await fetch(`https://healthtrack.pythonanywhere.com/api/medications/${medicationId}/`, {
                      method: 'DELETE',
                      headers: {
                          'Authorization': `Bearer ${token}`,
                          'Content-Type': 'application/json'
                      }
                  });
                  
                  if (!response.ok) {
                      throw new Error('Failed to delete medication');
                  }
                  
                  showToast('Medication deleted successfully!');
                  fetchMedications(); // Refresh the list
              } catch (error) {
                  console.error('Error deleting medication:', error);
                  showToast('Failed to delete medication', false);
              }
          });
      }
      
      // Fetch conditions from API
      async function fetchConditions() {
          try {
              const token = localStorage.getItem('access_token');
              const response = await fetch('https://healthtrack.pythonanywhere.com/api/chronic-conditions/', {
                  headers: {
                      'Authorization': `Bearer ${token}`,
                      'Content-Type': 'application/json'
                  }
              });
              
              if (!response.ok) {
                  throw new Error('Failed to fetch conditions');
              }
              
              const conditions = await response.json();
              renderConditions(conditions);
              return conditions; // Return conditions for medication dropdown
          } catch (error) {
              console.error('Error fetching conditions:', error);
              conditionsContainer.innerHTML = `
                  <div class="alert alert-warning">
                      Failed to load conditions. Please try again later.
                  </div>
              `;
              return [];
          }
      }
      
      // Render conditions to the DOM
      function renderConditions(conditions) {
          if (conditions.length === 0) {
              conditionsContainer.innerHTML = `
                  <div class="text-center py-4" style="color: #666;">
                      <i class="fas fa-info-circle fa-2x mb-3"></i>
                      <p>No chronic conditions recorded yet.</p>
                  </div>
              `;
              return;
          }
          
          conditionsContainer.innerHTML = '';
          conditions.forEach(condition => {
              conditionsContainer.innerHTML += createConditionCard(condition);
          });
          
          // Add event listeners to delete buttons
          document.querySelectorAll('.delete-condition').forEach(button => {
              button.addEventListener('click', (e) => {
                  e.stopPropagation();
                  deleteCondition(button.dataset.id);
              });
          });
      }
      
      // Fetch medications from API
      async function fetchMedications() {
          try {
              const token = localStorage.getItem('access_token');
              const response = await fetch('https://healthtrack.pythonanywhere.com/api/medications/', {
                  headers: {
                      'Authorization': `Bearer ${token}`,
                      'Content-Type': 'application/json'
                  }
              });
              
              if (!response.ok) {
                  throw new Error('Failed to fetch medications');
              }
              
              const medications = await response.json();
              renderMedications(medications);
          } catch (error) {
              console.error('Error fetching medications:', error);
              medicationsContainer.innerHTML = `
                  <div class="alert alert-warning">
                      Failed to load medications. Please try again later.
                  </div>
              `;
          }
      }
      
      // Populate conditions dropdown
      function populateConditionsDropdown(conditions) {
          conditionSelect.innerHTML = '<option value="">Select condition</option>';
          conditions.forEach(condition => {
              const option = document.createElement('option');
              option.value = condition.id;
              option.textContent = condition.name;
              conditionSelect.appendChild(option);
          });
      }
      
      // Render medications to the DOM
      function renderMedications(medications) {
          if (medications.length === 0) {
              medicationsContainer.innerHTML = `
                  <div class="text-center py-4" style="color: #666;">
                      <i class="fas fa-info-circle fa-2x mb-3"></i>
                      <p>No medications recorded yet.</p>
                  </div>
              `;
              return;
          }
          
          medicationsContainer.innerHTML = '';
          medications.forEach(medication => {
              medicationsContainer.innerHTML += createMedicationCard(medication);
          });
          
          // Add event listeners to delete buttons
          document.querySelectorAll('.delete-medication').forEach(button => {
              button.addEventListener('click', (e) => {
                  e.stopPropagation();
                  deleteMedication(button.dataset.id);
              });
          });
      }
      
      // Handle condition form submission
      conditionForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const token = localStorage.getItem('access_token');
          const formData = {
              name: document.getElementById('conditionName').value,
              diagnosis_date: document.getElementById('diagnosisDate').value,
              status: document.getElementById('conditionStatus').value,
              notes: document.getElementById('conditionNotes').value
          };
          
          try {
              const response = await fetch('https://healthtrack.pythonanywhere.com/api/chronic-conditions/', {
                  method: 'POST',
                  headers: {
                      'Authorization': `Bearer ${token}`,
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(formData)
              });
              
              if (!response.ok) {
                  throw new Error('Failed to add condition');
              }
              
              const newCondition = await response.json();
              closeModal(conditionModal);
              showToast('Condition added successfully!');
              fetchConditions(); // Refresh the list
          } catch (error) {
              console.error('Error adding condition:', error);
              showToast('Failed to add condition', false);
          }
      });
      
      // Handle medication form submission
      medicationForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const token = localStorage.getItem('access_token');
          const formData = {
              name: document.getElementById('medicationName').value,
              dosage: document.getElementById('dosage').value,
              schedule: document.getElementById('schedule').value,
              reminder_time: document.getElementById('reminderTime').value || null,
              has_reminder: document.getElementById('hasReminder').checked,
              condition: document.getElementById('condition').value || null,
              notes: document.getElementById('medicationNotes').value
          };
          
          try {
              const response = await fetch('https://healthtrack.pythonanywhere.com/api/medications/', {
                  method: 'POST',
                  headers: {
                      'Authorization': `Bearer ${token}`,
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(formData)
              });
              
              if (!response.ok) {
                  throw new Error('Failed to add medication');
              }
              
              const newMedication = await response.json();
              closeModal(medicationModal);
              showToast('Medication added successfully!');
              fetchMedications(); // Refresh the list
          } catch (error) {
              console.error('Error adding medication:', error);
              showToast('Failed to add medication', false);
          }
      });
      
      // Initial data loading
      async function initialize() {
          const conditions = await fetchConditions();
          populateConditionsDropdown(conditions);
          fetchMedications();
      }
      
      initialize();
  });
</script>
<!-- Modal CSS -->
<style>
  .custom-modal {
    display: none;
    position: fixed;
    z-index: 9999;
    padding-top: 100px;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.5);
  }

  .custom-modal-content {
    background-color: #f5e8e0;
    margin: auto;
    padding: 25px;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    position: relative;
    color: #2a2a2a;
    border: 1px solid #d4c4b8;
  }

  .close {
    color: #7a6b5f;
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }

  .close:hover {
    color: #2a2a2a;
  }

  .form-control {
    background-color: #fffcf9;
    border: 1px solid #d4c4b8;
    color: #2a2a2a;
  }

  .form-control:focus {
    background-color: #fffcf9;
    border-color: #b8a99d;
    box-shadow: 0 0 0 0.25rem rgba(180, 160, 140, 0.25);
  }

  .form-label {
    font-weight: 500;
    color: #3a3a3a;
  }

  h5 {
    color: #3a3a3a;
    font-weight: 600;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid #d4c4b8;
  }
</style>

<!-- Modal JS -->
<script>
  const openBtn = document.getElementById("openMedicationModal");
  const modal = document.getElementById("customMedicationModal");
  const closeBtn = document.getElementById("closeMedicationModal");
  const cancelBtn = document.getElementById("cancelBtn");

  openBtn.addEventListener("click", () => {
    modal.style.display = "block";
  });

  closeBtn.addEventListener("click", () => {
    modal.style.display = "none";
  });

 
  window.addEventListener("click", (e) => {
    if (e.target === modal) {
      modal.style.display = "none";
    }
  });
</script>
<!-- Vitals & Appointments -->
<div class="row mt-4 g-4" style="background-color: transparent;">
  <!-- VITALS -->
  <div class="col-lg-6 mb-4">
    <div class="card border-0 shadow-sm h-100" style="background-color: #fffdf8; box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);">
      <div class="card-header border-0 bg-transparent">
        <i class="fas fa-heartbeat me-2 text-info"></i>
        <span class="fw-bold text-info">Vitals Overview</span>
      </div>
      <div class="card-body" id="vitalsContainer">
        <!-- Vitals will be populated here by JavaScript -->
      </div>
      <div class="card-footer bg-transparent border-0 text-end">
        <button class="btn btn-sm btn-outline-info" id="openVitalsModal">
          <i class="fas fa-plus me-1"></i>Record New Vitals
        </button>
      </div>
    </div>
  </div>

  <!-- APPOINTMENTS -->
  <div class="col-lg-6 mb-4">
    <div class="card border-0 shadow-sm h-100" style="background-color: #fffdf8; box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);">
      <div class="card-header border-0 bg-transparent">
        <i class="fas fa-calendar-check me-2 text-warning"></i>
        <span class="fw-bold text-warning">Upcoming Appointments</span>
        <p class="text-muted mb-0 small">Your next scheduled visits</p>
      </div>
      <div class="card-body" id="appointmentsContainer">
        <!-- Appointments will be populated here by JavaScript -->
      </div>
      <div class="card-footer bg-transparent border-0 text-end">
        <button class="btn btn-sm btn-outline-warning me-2" id="openScheduleModal">
          <i class="fas fa-plus me-1"></i>Schedule Appointment
        </button>
      </div>
    </div>
  </div>
</div>


<!-- Vitals Modal -->
<div id="vitalsModal" class="modal fade" tabindex="-1" aria-labelledby="vitalsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" style="max-height: 70vh;">
    <div class="modal-content" style="background-color: #fffdf8; max-height: 70vh; overflow-y: auto;">
      <div class="modal-header border-0" style="background-color: #fffdf8;">
        <h5 class="modal-title text-dark fw-bold" id="vitalsModalLabel">
          <i class="fas fa-heartbeat me-2" style="color: #8b7355;"></i>Record New Vitals
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-dark">
        <form id="vitalsForm">
          <div class="row g-3">
            <div class="col-md-6">
              <label for="bloodPressureSystolic" class="form-label fw-semibold">Blood Pressure (Systolic)</label>
              <input type="number" class="form-control" id="bloodPressureSystolic" placeholder="120" style="background-color: #fffefb;">
            </div>
            <div class="col-md-6">
              <label for="bloodPressureDiastolic" class="form-label fw-semibold">Blood Pressure (Diastolic)</label>
              <input type="number" class="form-control" id="bloodPressureDiastolic" placeholder="80" style="background-color: #fffefb;">
            </div>
            <div class="col-md-6">
              <label for="bloodSugar" class="form-label fw-semibold">Blood Sugar (mg/dL)</label>
              <input type="number" step="0.1" class="form-control" id="bloodSugar" placeholder="95" style="background-color: #fffefb;">
            </div>
            <div class="col-md-6">
              <label for="heartRate" class="form-label fw-semibold">Heart Rate (bpm)</label>
              <input type="number" class="form-control" id="heartRate" placeholder="72" style="background-color: #fffefb;">
            </div>
            <div class="col-md-6">
              <label for="weight" class="form-label fw-semibold">Weight (kg)</label>
              <input type="number" step="0.1" class="form-control" id="weight" placeholder="68" style="background-color: #fffefb;">
            </div>
            <div class="col-md-6">
              <label for="spo2" class="form-label fw-semibold">SpO2 (%)</label>
              <input type="number" class="form-control" id="spo2" placeholder="98" min="0" max="100" style="background-color: #fffefb;">
            </div>
            <div class="col-md-6">
              <label for="vitalsDate" class="form-label fw-semibold">Date & Time</label>
              <input type="datetime-local" class="form-control" id="vitalsDate" style="background-color: #fffefb;">
            </div>
            <div class="col-12">
              <label for="notes" class="form-label fw-semibold">Notes</label>
              <textarea class="form-control" id="notes" rows="2" style="background-color: #fffefb;"></textarea>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer border-0" style="background-color: #fffdf8;">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" onfocus="this.blur()">Cancel</button>
        <button type="button" class="btn text-white" id="saveVitals" style="background-color: #8b7355;">Save Vitals</button>
      </div>
    </div>
  </div>
</div>


<!-- Schedule Appointment Modal -->
<div id="scheduleModal" class="modal fade" tabindex="-1" aria-labelledby="scheduleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0" style="background-color: #fffdf8; border: 2px solid #00bcd4; border-radius: 16px;">
      <div class="modal-header border-0 py-2">
        <h6 class="modal-title fw-bold text-dark" id="scheduleModalLabel">
          <i class="fas fa-calendar-plus me-2 text-warning"></i>New Appointment
        </h6>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-dark pt-1">
        <form id="appointmentForm">
          <!-- Provider Info -->
          <div class="mb-3">
            <label for="providerName" class="form-label small fw-semibold">Provider Name</label>
            <input type="text" class="form-control form-control-sm" id="providerName" required>
          </div>
          
          <div class="mb-3">
            <label for="providerSpecialty" class="form-label small fw-semibold">Specialty</label>
            <input type="text" class="form-control form-control-sm" id="providerSpecialty" required>
          </div>

          <!-- Date and Time -->
          <div class="mb-3">
            <label for="appointmentDateTime" class="form-label small fw-semibold">Date & Time</label>
            <input type="datetime-local" class="form-control form-control-sm" id="appointmentDateTime" required>
          </div>

          <!-- Location -->
          <div class="mb-3">
            <label for="location" class="form-label small fw-semibold">Location</label>
            <input type="text" class="form-control form-control-sm" id="location" required>
          </div>

          <!-- Notes -->
          <div class="mb-3">
            <label for="notes1" class="form-label small fw-semibold">Notes</label>
            <textarea class="form-control form-control-sm" id="notes1" rows="2"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer border-0 pt-0">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" onfocus="this.blur()">Cancel</button>
        <button type="button" class="btn btn-sm btn-warning text-dark" id="saveAppointment">Confirm</button>
      </div>
    </div>
  </div>
</div>

<style>
  /* Toast Notification Styles */
  .toast-notification {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 12px 24px;
    background-color: #4CAF50;
    color: white;
    border-radius: 4px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    z-index: 1000;
    animation: fadein 0.5s, fadeout 0.5s 2.5s;
  }
  
  .toast-notification.error {
    background-color: #f44336;
  }
  
  @keyframes fadein {
    from {opacity: 0;}
    to {opacity: 1;}
  }
  
  @keyframes fadeout {
    from {opacity: 1;}
    to {opacity: 0;}
  }
  
  /* Confirm Toast Styles */
  .confirm-toast {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    z-index: 10000;
    max-width: 90%;
    width: 400px;
    text-align: center;
  }
  
  .confirm-toast p {
    margin-bottom: 20px;
    font-size: 16px;
    color: #333;
  }
  
  .confirm-toast-buttons {
    display: flex;
    justify-content: center;
    gap: 10px;
  }
  
  .confirm-toast-btn {
    padding: 8px 20px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.2s;
  }
  
  .confirm-toast-confirm {
    background-color: #dc3545;
    color: white;
  }
  
  .confirm-toast-confirm:hover {
    background-color: #c82333;
  }
  
  .confirm-toast-cancel {
    background-color: #6c757d;
    color: white;
  }
  
  .confirm-toast-cancel:hover {
    background-color: #5a6268;
  }
  
  /* Past Appointments */
  .past-appointment {
    opacity: 0.7;
    position: relative;
  }
  
  .past-appointment::after {
    content: "Passed";
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: #6c757d;
    color: white;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
  }
  
  /* Delete Button Styles */
  .delete-btn {
    color: #dc3545;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 16px;
    transition: color 0.2s;
  }
  
  .delete-btn:hover {
    color: #b02a37;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
      // Toast Notification Function
      function showToast(message, isSuccess = true) {
          const toast = document.createElement('div');
          toast.className = isSuccess ? 'toast-notification' : 'toast-notification error';
          toast.textContent = message;
          document.body.appendChild(toast);
          
          setTimeout(() => {
              document.body.removeChild(toast);
          }, 3000);
      }
      
      // Confirm Toast Function
      function showConfirmToast(message, confirmCallback) {
          const toast = document.createElement('div');
          toast.className = 'confirm-toast';
          toast.innerHTML = `
              <p>${message}</p>
              <div class="confirm-toast-buttons">
                  <button class="confirm-toast-btn confirm-toast-cancel">Cancel</button>
                  <button class="confirm-toast-btn confirm-toast-confirm">Confirm</button>
              </div>
          `;
          
          document.body.appendChild(toast);
          
          // Add event listeners
          const cancelBtn = toast.querySelector('.confirm-toast-cancel');
          const confirmBtn = toast.querySelector('.confirm-toast-confirm');
          
          const removeToast = () => {
              document.body.removeChild(toast);
          };
          
          cancelBtn.addEventListener('click', () => {
              removeToast();
          });
          
          confirmBtn.addEventListener('click', () => {
              confirmCallback();
              removeToast();
          });
      }
      
      // Vitals Modal Functionality
      const vitalsContainer = document.getElementById('vitalsContainer');
      const openVitalsModalBtn = document.getElementById('openVitalsModal');
      const vitalsForm = document.getElementById('vitalsForm');
      const saveVitalsBtn = document.getElementById('saveVitals');
      const vitalsModal = new bootstrap.Modal(document.getElementById('vitalsModal'), {
          backdrop: true,
          keyboard: true
      });
      
      // Format date for display
      function formatDateTime(dateString) {
          const options = { 
              year: 'numeric', 
              month: 'short', 
              day: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
          };
          return new Date(dateString).toLocaleDateString(undefined, options);
      }
      
      // Create vital card HTML with delete button
      function createVitalCard(vital) {
          const bpDisplay = vital.blood_pressure || '--/--';
          const bloodSugar = vital.blood_sugar ? `${vital.blood_sugar} mg/dL` : '--';
          const heartRate = vital.heart_rate ? `${vital.heart_rate} bpm` : '--';
          const weight = vital.weight ? `${vital.weight} kg` : '--';
          const spo2 = vital.spo2 ? `${vital.spo2}%` : '--';
          
          return `
              <div class="vital-card" data-id="${vital.id}">
                  <div class="card border-0 shadow mb-3 p-3" style="background-color: #fffefb; box-shadow: 0 6px 14px rgba(0, 0, 0, 0.2);">
                      <div class="d-flex justify-content-between align-items-start">
                          <div>
                              <span class="text-info fw-semibold">Blood Pressure</span>
                              <div class="small text-success">${formatDateTime(vital.recorded_at)}</div>
                          </div>
                          <div class="d-flex align-items-center">
                              <span class="fw-bold me-3">${bpDisplay} mmHg</span>
                              <button class="delete-btn delete-vital" data-id="${vital.id}" title="Delete vitals">
                                  <i class="fas fa-trash-alt"></i>
                              </button>
                          </div>
                      </div>
                  </div>
                  <div class="card border-0 shadow mb-3 p-3" style="background-color: #fffefb; box-shadow: 0 6px 14px rgba(0, 0, 0, 0.2);">
                      <div class="d-flex justify-content-between align-items-start">
                          <div>
                              <span class="text-info fw-semibold">Blood Sugar</span>
                              <div class="small text-success">${formatDateTime(vital.recorded_at)}</div>
                          </div>
                          <span class="fw-bold">${bloodSugar}</span>
                      </div>
                  </div>
                  <div class="card border-0 shadow mb-3 p-3" style="background-color: #fffefb; box-shadow: 0 6px 14px rgba(0, 0, 0, 0.2);">
                      <div class="d-flex justify-content-between align-items-start">
                          <div>
                              <span class="text-info fw-semibold">Heart Rate</span>
                              <div class="small text-success">${formatDateTime(vital.recorded_at)}</div>
                          </div>
                          <span class="fw-bold">${heartRate}</span>
                      </div>
                  </div>
                  <div class="card border-0 shadow mb-3 p-3" style="background-color: #fffefb; box-shadow: 0 6px 14px rgba(0, 0, 0, 0.2);">
                      <div class="d-flex justify-content-between align-items-start">
                          <div>
                              <span class="text-info fw-semibold">Weight</span>
                              <div class="small text-success">${formatDateTime(vital.recorded_at)}</div>
                          </div>
                          <span class="fw-bold">${weight}</span>
                      </div>
                  </div>
                  <div class="card border-0 shadow mb-3 p-3" style="background-color: #fffefb; box-shadow: 0 6px 14px rgba(0, 0, 0, 0.2);">
                      <div class="d-flex justify-content-between align-items-start">
                          <div>
                              <span class="text-info fw-semibold">SpO2</span>
                              <div class="small text-success">${formatDateTime(vital.recorded_at)}</div>
                          </div>
                          <span class="fw-bold">${spo2}</span>
                      </div>
                  </div>
              </div>
          `;
      }
      
      // Fetch vitals from API
      async function fetchVitals() {
          try {
              const token = localStorage.getItem('access_token');
              const response = await fetch('https://healthtrack.pythonanywhere.com/api/vitals/', {
                  headers: {
                      'Authorization': `Bearer ${token}`,
                      'Content-Type': 'application/json'
                  }
              });
              
              if (!response.ok) {
                  throw new Error('Failed to fetch vitals');
              }
              
              const vitals = await response.json();
              renderVitals(vitals);
          } catch (error) {
              console.error('Error fetching vitals:', error);
              vitalsContainer.innerHTML = `
                  <div class="alert alert-warning">
                      Failed to load vitals. Please try again later.
                  </div>
              `;
          }
      }
      
      // Render vitals to the DOM
      function renderVitals(vitals) {
          if (vitals.length === 0) {
              vitalsContainer.innerHTML = `
                  <div class="text-center py-4" style="color: #666;">
                      <i class="fas fa-info-circle fa-2x mb-3"></i>
                      <p>No vitals recorded yet.</p>
                  </div>
              `;
              return;
          }
          
          // Get the most recent vitals record
          const latestVitals = vitals[0];
          vitalsContainer.innerHTML = createVitalCard(latestVitals);
          
          // Add event listener for delete button
          document.querySelector('.delete-vital')?.addEventListener('click', function(e) {
              e.stopPropagation();
              const vitalId = this.dataset.id;
              showConfirmToast('Are you sure you want to delete this vitals record?', () => {
                  deleteVital(vitalId);
              });
          });
      }
      
      // Delete vital record
      async function deleteVital(vitalId) {
          try {
              const token = localStorage.getItem('access_token');
              const response = await fetch(`https://healthtrack.pythonanywhere.com/api/vitals/${vitalId}/`, {
                  method: 'DELETE',
                  headers: {
                      'Authorization': `Bearer ${token}`
                  }
              });
              
              if (!response.ok) {
                  throw new Error('Failed to delete vitals');
              }
              
              showToast('Vitals record deleted successfully!');
              fetchVitals(); // Refresh the vitals display
          } catch (error) {
              console.error('Error deleting vitals:', error);
              showToast('Failed to delete vitals. Please try again.', false);
          }
      }
      
      // Handle form submission
      saveVitalsBtn.addEventListener('click', async function() {
          const token = localStorage.getItem('access_token');
          const formData = {
              blood_pressure_systolic: document.getElementById('bloodPressureSystolic').value || null,
              blood_pressure_diastolic: document.getElementById('bloodPressureDiastolic').value || null,
              blood_sugar: document.getElementById('bloodSugar').value || null,
              heart_rate: document.getElementById('heartRate').value || null,
              weight: document.getElementById('weight').value || null,
              spo2: document.getElementById('spo2').value || null,
              recorded_at: document.getElementById('vitalsDate').value || new Date().toISOString(),
              notes: document.getElementById('notes').value
          };
          
          try {
              const response = await fetch('https://healthtrack.pythonanywhere.com/api/vitals/', {
                  method: 'POST',
                  headers: {
                      'Authorization': `Bearer ${token}`,
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(formData)
              });
              
              if (!response.ok) {
                  throw new Error('Failed to save vitals');
              }
              
              const newVitals = await response.json();
              vitalsModal.hide();
              vitalsForm.reset();
              showToast('Vitals recorded successfully!');
              fetchVitals(); // Refresh the vitals display
          } catch (error) {
              console.error('Error saving vitals:', error);
              showToast('Failed to save vitals. Please try again.', false);
          }
      });
      
      // Modal event listener
      openVitalsModalBtn.addEventListener('click', function() {
          vitalsModal.show();
      });
      
      // Set current datetime as default
      document.getElementById('vitalsDate').value = new Date().toISOString().slice(0, 16);
      
      // Appointments Modal Functionality
      const appointmentsContainer = document.getElementById('appointmentsContainer');
      const openScheduleModalBtn = document.getElementById('openScheduleModal');
      const saveAppointmentBtn = document.getElementById('saveAppointment');
      const appointmentForm = document.getElementById('appointmentForm');
      const scheduleModal = new bootstrap.Modal(document.getElementById('scheduleModal'), {
          backdrop: true,
          keyboard: true
      });
      
      // Format date for display
      function formatAppointmentDate(dateTimeString) {
          const date = new Date(dateTimeString);
          const options = { 
              month: 'short', 
              day: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
          };
          return date.toLocaleDateString(undefined, options);
      }
      
      // Format calendar date display
      function getCalendarDate(dateTimeString) {
          const date = new Date(dateTimeString);
          return {
              month: date.toLocaleString('default', { month: 'short' }),
              day: date.getDate(),
              time: date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
          };
      }
      
      // Check if appointment is in the past
      function isPastAppointment(dateTimeString) {
          return new Date(dateTimeString) < new Date();
      }
      
      // Create appointment card HTML with delete button
      function createAppointmentCard(appointment) {
          const dateInfo = getCalendarDate(appointment.appointment_date);
          const isPast = isPastAppointment(appointment.appointment_date);
          const pastClass = isPast ? 'past-appointment' : '';
          
          return `
              <div class="appointment-card ${pastClass}" data-id="${appointment.id}">
                  <div class="card border-0 shadow mb-4 p-4" style="background-color: #fffefb; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2); border-radius: 20px; position: relative;">
                      ${isPast ? '<span class="badge bg-secondary position-absolute top-0 start-0 m-2">Passed</span>' : ''}
                      <div class="d-flex align-items-center mb-3">
                          <div class="text-center px-3 py-2 me-3 border rounded" style="min-width: 60px; background-color: #fffdf8;">
                              <div class="fw-bold text-muted" style="font-size: 0.8rem;">${dateInfo.month}</div>
                              <div class="fw-bold text-dark" style="font-size: 1.4rem;">${dateInfo.day}</div>
                          </div>
                          <div>
                              <h6 class="mb-1 fw-bold" style="font-size: 1rem;">${dateInfo.time}</h6>
                              <div class="text-muted small">${appointment.provider_name}</div>
                              <div class="text-muted small">${appointment.provider_specialty}</div>
                          </div>
                      </div>
                      <hr>
                      <div class="text-muted small mb-2">
                          <i class="fas fa-map-marker-alt me-1"></i>${appointment.location}
                      </div>
                      <div class="d-flex justify-content-between align-items-center">
                          <div>
                              <button class="btn btn-sm btn-outline-warning me-2" onclick="getDirections('${appointment.location}')">
                                  <i class="fas fa-directions me-1"></i>Get Directions
                              </button>
                              <button class="btn btn-sm btn-outline-secondary" onclick="addToCalendar(${JSON.stringify(appointment)})">
                                  <i class="fas fa-calendar-plus me-1"></i>Add to Calendar
                              </button>
                          </div>
                          <button class="delete-btn delete-appointment" data-id="${appointment.id}" title="Delete appointment">
                              <i class="fas fa-trash-alt"></i>
                          </button>
                      </div>
                  </div>
              </div>
          `;
      }
      
      // Fetch appointments from API
      async function fetchAppointments() {
          try {
              const token = localStorage.getItem('access_token');
              const response = await fetch('https://healthtrack.pythonanywhere.com/api/appointments/', {
                  headers: {
                      'Authorization': `Bearer ${token}`,
                      'Content-Type': 'application/json'
                  }
              });
              
              if (!response.ok) {
                  throw new Error('Failed to fetch appointments');
              }
              
              const appointments = await response.json();
              renderAppointments(appointments);
          } catch (error) {
              console.error('Error fetching appointments:', error);
              appointmentsContainer.innerHTML = `
                  <div class="alert alert-warning">
                      Failed to load appointments. Please try again later.
                  </div>
              `;
          }
      }
      
      // Render appointments to the DOM
      function renderAppointments(appointments) {
          if (appointments.length === 0) {
              appointmentsContainer.innerHTML = `
                  <div class="text-center py-4" style="color: #666;">
                      <i class="fas fa-info-circle fa-2x mb-3"></i>
                      <p>No upcoming appointments scheduled.</p>
                  </div>
              `;
              return;
          }
          
          // Sort appointments by date (soonest first)
          appointments.sort((a, b) => new Date(a.appointment_date) - new Date(b.appointment_date));
          
          appointmentsContainer.innerHTML = '';
          appointments.forEach(appointment => {
              appointmentsContainer.innerHTML += createAppointmentCard(appointment);
          });
          
          // Add event listeners for delete buttons
          document.querySelectorAll('.delete-appointment').forEach(button => {
              button.addEventListener('click', function(e) {
                  e.stopPropagation();
                  const appointmentId = this.dataset.id;
                  showConfirmToast('Are you sure you want to delete this appointment?', () => {
                      deleteAppointment(appointmentId);
                  });
              });
          });
      }
      
      // Delete appointment
      async function deleteAppointment(appointmentId) {
          try {
              const token = localStorage.getItem('access_token');
              const response = await fetch(`https://healthtrack.pythonanywhere.com/api/appointments/${appointmentId}/`, {
                  method: 'DELETE',
                  headers: {
                      'Authorization': `Bearer ${token}`
                  }
              });
              
              if (!response.ok) {
                  throw new Error('Failed to delete appointment');
              }
              
              showToast('Appointment deleted successfully!');
              fetchAppointments(); // Refresh the appointments list
          } catch (error) {
              console.error('Error deleting appointment:', error);
              showToast('Failed to delete appointment. Please try again.', false);
          }
      }
      
      // Handle form submission
      saveAppointmentBtn.addEventListener('click', async function() {
          const token = localStorage.getItem('access_token');
          const formData = {
              provider_name: document.getElementById('providerName').value,
              provider_specialty: document.getElementById('providerSpecialty').value,
              appointment_date: document.getElementById('appointmentDateTime').value,
              location: document.getElementById('location').value,
              notes: document.getElementById('notes1').value,
              is_completed: false
          };
          
          try {
              const response = await fetch('https://healthtrack.pythonanywhere.com/api/appointments/', {
                  method: 'POST',
                  headers: {
                      'Authorization': `Bearer ${token}`,
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(formData)
              });
              
              if (!response.ok) {
                  throw new Error('Failed to save appointment');
              }
              
              const newAppointment = await response.json();
              scheduleModal.hide();
              appointmentForm.reset();
              showToast('Appointment scheduled successfully!');
              fetchAppointments(); // Refresh the appointments list
          } catch (error) {
              console.error('Error saving appointment:', error);
              showToast('Failed to schedule appointment. Please try again.', false);
          }
      });
      
      // Modal event listeners
      openScheduleModalBtn.addEventListener('click', function() {
          scheduleModal.show();
      });
      
      // Helper functions for buttons
      window.getDirections = function(location) {
          window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`, '_blank');
      };
      
      window.addToCalendar = function(appointment) {
          const startDate = new Date(appointment.appointment_date).toISOString().replace(/-|:|\.\d+/g, '');
          const endDate = new Date(new Date(appointment.appointment_date).getTime() + 30*60000).toISOString().replace(/-|:|\.\d+/g, '');
          const calendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&dates=${startDate}/${endDate}&text=Appointment+with+${encodeURIComponent(appointment.provider_name)}&location=${encodeURIComponent(appointment.location)}&details=${encodeURIComponent(appointment.notes || '')}`;
          window.open(calendarUrl, '_blank');
          showToast('Opening Google Calendar...');
      };
      
      // Set current datetime as default
      const now = new Date();
      now.setMinutes(0);
      document.getElementById('appointmentDateTime').value = now.toISOString().slice(0, 16);
      
      // Initial fetch
      fetchVitals();
      fetchAppointments();
  });
</script>

<style>
  .past-appointment {
      opacity: 0.7;
  }
  
  .delete-vital, .delete-appointment {
      transition: all 0.2s ease;
  }
  
  .delete-vital:hover, .delete-appointment:hover {
      transform: scale(1.1);
  }
  
  .vital-card, .appointment-card {
      transition: all 0.3s ease;
  }
  
  .vital-card:hover, .appointment-card:hover {
      transform: translateY(-2px);
  }
</style>

<style>
/* Modal styling */
.modal-content {
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
  border: none;
}

/* Input focus styling */
.form-control:focus {
  border-color: #0dcaf0;
  box-shadow: 0 0 0 0.25rem rgba(13, 202, 240, 0.25);
  background-color: #fffefb;
}

/* Button styling */
.btn-info {
  background-color: #0dcaf0;
  border-color: #0dcaf0;
}

.btn-info:hover {
  background-color: #0aa2c0;
  border-color: #0aa2c0;
}
</style>


      

<style>
  .action-card {
    background-color: #fffdf8;
    border: none;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    padding: 1rem;
    height: 100%;
  }

  .action-icon-btn {
    padding: 1.5rem;
    border-radius: 50%;
    font-size: 1.75rem;
  }

  .action-label {
    margin-top: 0.5rem;
    font-weight: 600;
    color: #222;
    font-size: 0.9rem;
  }
</style>
<!-- Emergency & Quick Actions (Custom Styling with Modals) -->
<div class="container mt-4 mb-5" style="font-family: Georgia, serif; font-size: 18px; margin-left: auto; margin-right: auto;">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10 col-sm-12" style="background: #ffffff; border-radius: 16px; padding: 20px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25); margin-left: 20px; margin-right: 20px;">
      <h5 class="text-danger fw-bold mb-3">
        <i class="fas fa-exclamation-triangle me-2"></i>Emergency & Quick Actions
      </h5>
      <div class="row text-center g-3">
        
        <!-- Emergency -->
        <div class="col-md-3 col-6">
          <div class="action-card" style="border: 2px solid #b30000; background: #f8d7da; border-radius: 12px; padding: 16px; box-shadow: 0 12px 36px rgba(0, 0, 0, 0.3);" data-bs-toggle="modal" data-bs-target="#emergencyModal">
            <button class="btn btn-outline-danger action-icon-btn">
              <i class="fas fa-ambulance"></i>
            </button>
            <div class="action-label mt-2">Emergency</div>
          </div>
        </div>

        <!-- Contact Doctor -->
        <div class="col-md-3 col-6">
          <div class="action-card" style="border: 2px solid #e6a900; background: #fff3cd; border-radius: 12px; padding: 16px; box-shadow: 0 12px 36px rgba(0, 0, 0, 0.3);" data-bs-toggle="modal" data-bs-target="#contactDoctorModal">
            <button class="btn btn-outline-warning action-icon-btn">
              <i class="fas fa-user-md"></i>
            </button>
            <div class="action-label mt-2">Contact Doctor</div>
          </div>
        </div>

        <!-- Find Pharmacy -->
        <div class="col-md-3 col-6">
          <div class="action-card" style="border: 2px solid #0062cc; background: #d1ecf1; border-radius: 12px; padding: 16px; box-shadow: 0 12px 36px rgba(0, 0, 0, 0.3);" data-bs-toggle="modal" data-bs-target="#findPharmacyModal">
            <button class="btn btn-outline-info action-icon-btn">
              <i class="fas fa-prescription-bottle-alt"></i>
            </button>
            <div class="action-label mt-2">Find Pharmacy</div>
          </div>
        </div>

        <!-- Log Symptom -->
        <div class="col-md-3 col-6">
          <div class="action-card" style="border: 2px solid #28a745; background: #d4edda; border-radius: 12px; padding: 16px; box-shadow: 0 12px 36px rgba(0, 0, 0, 0.3);" data-bs-toggle="modal" data-bs-target="#logSymptomModal">
            <button class="btn btn-outline-success action-icon-btn">
              <i class="fas fa-notes-medical"></i>
            </button>
            <div class="action-label mt-2">Log Symptom</div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- Modal for Emergency -->
<div class="modal fade" id="emergencyModal" tabindex="-1" aria-labelledby="emergencyModalLabel">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="background: #f8f9fa;">
      <div class="modal-header">
        <h5 class="modal-title" id="emergencyModalLabel">Emergency Contacts</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="this.blur();"></button>
      </div>
      <div class="modal-body" style="background: #f7e7d3; color: #333;">
        <div id="emergencyContactsList">
          <div class="text-center py-3">
            <div class="spinner-border text-danger" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </div>
        <div class="text-center mt-3">
          <button class="btn btn-danger" onclick="callEmergency()">
            <i class="fas fa-phone me-2"></i>Call Emergency Services
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal for Contact Doctor -->
<div class="modal fade" id="contactDoctorModal" tabindex="-1" aria-labelledby="contactDoctorModalLabel">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="background: #f8f9fa;">
      <div class="modal-header">
        <h5 class="modal-title" id="contactDoctorModalLabel">Available Doctors</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="this.blur();"></button>
      </div>
      <div class="modal-body" style="background: #fff3cd; color: #333;">
        <div class="mb-3">
          <label for="doctorSpecialization" class="form-label">Filter by Specialization:</label>
          <select class="form-select" id="doctorSpecialization" onchange="filterDoctors()">
            <option value="">All Specializations</option>
            <option value="GP">General Practitioner</option>
            <option value="CAR">Cardiologist</option>
            <option value="DER">Dermatologist</option>
            <option value="PED">Pediatrician</option>
            <option value="ORT">Orthopedist</option>
            <option value="NEU">Neurologist</option>
            <option value="ONC">Oncologist</option>
            <option value="PSY">Psychiatrist</option>
            <option value="OTH">Other</option>
          </select>
        </div>
        <div id="doctorsList">
          <div class="text-center py-3">
            <div class="spinner-border text-warning" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal for Find Pharmacy -->
<div class="modal fade" id="findPharmacyModal" tabindex="-1" aria-labelledby="findPharmacyModalLabel">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="background: #f8f9fa;">
      <div class="modal-header">
        <h5 class="modal-title" id="findPharmacyModalLabel">Nearby Pharmacies</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="this.blur();"></button>
      </div>
      <div class="modal-body" style="background: #d1ecf1; color: #333;">
        <div class="mb-3">
          <button class="btn btn-sm btn-info mb-2" onclick="getLocationAndPharmacies()">
            <i class="fas fa-location-arrow me-1"></i>Use My Current Location
          </button>
          <div id="locationStatus" class="small text-muted"></div>
        </div>
        <div id="pharmaciesList">
          <div class="text-center py-3">
            <div class="spinner-border text-info" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal for Log Symptom -->
<div class="modal fade" id="logSymptomModal" tabindex="-1" aria-labelledby="logSymptomModalLabel">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="background: #f8f9fa;">
      <div class="modal-header">
        <h5 class="modal-title" id="logSymptomModalLabel">Log Symptom</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="this.blur();"></button>
      </div>
      <div class="modal-body" style="background: #fdf5e6; color: #333;">
        <form id="symptomForm">
          <div class="mb-3">
            <label for="symptomDescription" class="form-label">Describe Your Symptom</label>
            <textarea class="form-control" id="symptomDescription" rows="4" placeholder="e.g. Headache, nausea..." required></textarea>
          </div>
          <div class="mb-3">
            <label for="symptomDuration" class="form-label">Duration</label>
            <input type="text" class="form-control" id="symptomDuration" placeholder="e.g. 2 days" required>
          </div>
          <div class="mb-3">
            <label for="symptomSeverity" class="form-label">Severity</label>
            <select class="form-select" id="symptomSeverity" required>
              <option value="" selected disabled>Select severity</option>
              <option value="MILD">Mild</option>
              <option value="MOD">Moderate</option>
              <option value="SEV">Severe</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="symptomNotes" class="form-label">Additional Notes (Optional)</label>
            <textarea class="form-control" id="symptomNotes" rows="2"></textarea>
          </div>
          <div class="text-end">
            <button type="submit" class="btn btn-success">Submit Symptom</button>
          </div>
        </form>
        <div id="symptomResponse" class="mt-3" style="display: none;"></div>
      </div>
    </div>
  </div>
</div>

<script>
// Global variables
let currentLocation = null;

document.addEventListener('DOMContentLoaded', function () {
    // Initialize modals
    const emergencyModal = new bootstrap.Modal(document.getElementById('emergencyModal'));
    const contactDoctorModal = new bootstrap.Modal(document.getElementById('contactDoctorModal'));
    const findPharmacyModal = new bootstrap.Modal(document.getElementById('findPharmacyModal'));
    const logSymptomModal = new bootstrap.Modal(document.getElementById('logSymptomModal'));

    // Load data when modals are shown
    document.getElementById('emergencyModal').addEventListener('shown.bs.modal', loadEmergencyContacts);
    document.getElementById('contactDoctorModal').addEventListener('shown.bs.modal', loadDoctors);
    document.getElementById('findPharmacyModal').addEventListener('shown.bs.modal', loadPharmacies);
    
    // Handle symptom form submission
    const symptomForm = document.getElementById('symptomForm');
    const symptomResponse = document.getElementById('symptomResponse');
    
    symptomForm.addEventListener('submit', handleSymptomSubmit);
});

function loadEmergencyContacts() {
    const accessToken = localStorage.getItem('access_token');
    if (!accessToken) {
        showLoginPrompt('emergencyContactsList');
        return;
    }

    fetch('https://healthtrack.pythonanywhere.com/api/emergency-contacts/', {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(err => { throw err; });
        }
        return response.json();
    })
    .then(data => {
        const container = document.getElementById('emergencyContactsList');
        if (data.length === 0) {
            container.innerHTML = `
                <div class="alert alert-warning">
                    No emergency contacts found. Please contact your local emergency services.
                </div>
            `;
            return;
        }

        let html = '<div class="list-group">';
        data.forEach(contact => {
            html += `
                <div class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">${contact.name}</h6>
                        <small>${contact.location || 'No location specified'}</small>
                    </div>
                    <p class="mb-1">${contact.description || 'No description available'}</p>
                    <small><a href="tel:${contact.phone_number}" class="text-danger"><i class="fas fa-phone me-1"></i>${contact.phone_number}</a></small>
                </div>
            `;
        });
        html += '</div>';
        container.innerHTML = html;
    })
    .catch(error => {
        console.error('Error loading emergency contacts:', error);
        document.getElementById('emergencyContactsList').innerHTML = `
            <div class="alert alert-danger">
                Failed to load emergency contacts. ${error.detail || error.message || ''}
            </div>
        `;
    });
}

function loadDoctors() {
    const accessToken = localStorage.getItem('access_token');
    if (!accessToken) {
        showLoginPrompt('doctorsList');
        return;
    }

    fetch('https://healthtrack.pythonanywhere.com/api/doctors/', {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(err => { throw err; });
        }
        return response.json();
    })
    .then(data => {
        window.doctorsData = data; // Store for filtering
        renderDoctors(data);
    })
    .catch(error => {
        console.error('Error loading doctors:', error);
        document.getElementById('doctorsList').innerHTML = `
            <div class="alert alert-danger">
                Failed to load doctors. ${error.detail || error.message || ''}
            </div>
        `;
    });
}

function filterDoctors() {
    const specialization = document.getElementById('doctorSpecialization').value;
    if (!window.doctorsData) return;

    let filteredDoctors = window.doctorsData;
    if (specialization) {
        filteredDoctors = window.doctorsData.filter(doctor => doctor.specialization === specialization);
    }
    
    renderDoctors(filteredDoctors);
}

function renderDoctors(doctors) {
    const container = document.getElementById('doctorsList');
    if (doctors.length === 0) {
        container.innerHTML = `
            <div class="alert alert-warning">
                No doctors available matching your criteria.
            </div>
        `;
        return;
    }

    let html = '<div class="list-group">';
    doctors.forEach(doctor => {
        html += `
            <div class="list-group-item list-group-item-action">
                <div class="d-flex w-100 justify-content-between">
                    <h6 class="mb-1">Dr. ${doctor.name}</h6>
                    <small class="badge bg-warning text-dark">${doctor.specialization_display}</small>
                </div>
                <p class="mb-1">
                    <span class="badge bg-${doctor.is_available ? 'success' : 'secondary'}">
                        ${doctor.is_available ? 'Available' : 'Not Available'}
                    </span>
                    ${doctor.hospital ? `  ${doctor.hospital}` : ''}
                </p>
                <p class="mb-1 small">${doctor.address || 'Address not specified'}</p>
                <small>
                    <a href="tel:${doctor.phone_number}" class="text-primary me-3"><i class="fas fa-phone me-1"></i>${doctor.phone_number}</a>
                    ${doctor.email ? `<a href="mailto:${doctor.email}" class="text-primary"><i class="fas fa-envelope me-1"></i>Email</a>` : ''}
                </small>
            </div>
        `;
    });
    html += '</div>';
    container.innerHTML = html;
}

function loadPharmacies() {
    const accessToken = localStorage.getItem('access_token');
    if (!accessToken) {
        showLoginPrompt('pharmaciesList');
        return;
    }

    // If we already have location, use it
    if (currentLocation) {
        fetchPharmaciesWithLocation(currentLocation.lat, currentLocation.lng);
    } else {
        // Show message to get location
        document.getElementById('pharmaciesList').innerHTML = `
            <div class="alert alert-info">
                Please enable location services to find nearby pharmacies.
            </div>
        `;
    }
}

function getLocationAndPharmacies() {
    const statusElement = document.getElementById('locationStatus');
    statusElement.textContent = 'Getting your location...';
    
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            position => {
                currentLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                statusElement.innerHTML = `
                    <i class="fas fa-check-circle text-success"></i> 
                    Location found (${currentLocation.lat.toFixed(4)}, ${currentLocation.lng.toFixed(4)})
                `;
                fetchPharmaciesWithLocation(currentLocation.lat, currentLocation.lng);
            },
            error => {
                console.error('Error getting location:', error);
                statusElement.innerHTML = `
                    <i class="fas fa-exclamation-circle text-danger"></i> 
                    Could not get your location: ${error.message}
                `;
                // Fallback to loading all pharmacies
                fetchPharmacies();
            }
        );
    } else {
        statusElement.innerHTML = `
            <i class="fas fa-exclamation-circle text-danger"></i> 
            Geolocation is not supported by this browser.
        `;
        // Fallback to loading all pharmacies
        fetchPharmacies();
    }
}

function fetchPharmaciesWithLocation(lat, lng) {
    const accessToken = localStorage.getItem('access_token');
    fetch(`https://healthtrack.pythonanywhere.com/api/pharmacies/nearest/?lat=${lat}&lng=${lng}`, {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(err => { throw err; });
        }
        return response.json();
    })
    .then(data => {
        renderPharmacies(data);
    })
    .catch(error => {
        console.error('Error loading pharmacies with location:', error);
        // Fallback to loading all pharmacies
        fetchPharmacies();
    });
}

function fetchPharmacies() {
    const accessToken = localStorage.getItem('access_token');
    fetch('https://healthtrack.pythonanywhere.com/api/pharmacies/', {
        method: 'GET',
        headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json'
        }
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(err => { throw err; });
        }
        return response.json();
    })
    .then(data => {
        renderPharmacies(data);
    })
    .catch(error => {
        console.error('Error loading pharmacies:', error);
        document.getElementById('pharmaciesList').innerHTML = `
            <div class="alert alert-danger">
                Failed to load pharmacies. ${error.detail || error.message || ''}
            </div>
        `;
    });
}

function renderPharmacies(pharmacies) {
    const container = document.getElementById('pharmaciesList');
    if (pharmacies.length === 0) {
        container.innerHTML = `
            <div class="alert alert-warning">
                No pharmacies found in your area.
            </div>
        `;
        return;
    }

    let html = '<div class="list-group">';
    pharmacies.forEach(pharmacy => {
        const distanceInfo = pharmacy.distance ? 
            `<small class="text-muted">~${pharmacy.distance.toFixed(1)} km away</small>` : 
            '';
        
        html += `
            <div class="list-group-item list-group-item-action">
                <div class="d-flex w-100 justify-content-between">
                    <h6 class="mb-1">${pharmacy.name}</h6>
                    ${pharmacy.is_24_hours ? '<span class="badge bg-success">24/7</span>' : ''}
                </div>
                <p class="mb-1">${pharmacy.address}</p>
                <small>
                    <a href="tel:${pharmacy.phone_number}" class="text-primary me-3">
                        <i class="fas fa-phone me-1"></i>${pharmacy.phone_number}
                    </a>
                    ${distanceInfo}
                </small>
                ${pharmacy.website ? `
                    <div class="mt-1">
                        <a href="${pharmacy.website}" target="_blank" class="text-info small">
                            <i class="fas fa-globe me-1"></i>Website
                        </a>
                    </div>
                ` : ''}
            </div>
        `;
    });
    html += '</div>';
    container.innerHTML = html;
}

function handleSymptomSubmit(e) {
    e.preventDefault();
    
    const accessToken = localStorage.getItem('access_token');
    if (!accessToken) {
        showLoginPrompt('symptomResponse');
        return;
    }

    const symptomData = {
        description: document.getElementById('symptomDescription').value,
        duration: document.getElementById('symptomDuration').value,
        severity: document.getElementById('symptomSeverity').value,
        notes: document.getElementById('symptomNotes').value
    };

    const symptomResponse = document.getElementById('symptomResponse');
    symptomResponse.style.display = 'none';

    fetch('https://healthtrack.pythonanywhere.com/api/symptoms/', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(symptomData)
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(err => { throw err; });
        }
        return response.json();
    })
    .then(data => {
        showResponse('Symptom logged successfully!', 'success');
        document.getElementById('symptomForm').reset();
        
        setTimeout(() => {
            const modal = bootstrap.Modal.getInstance(document.getElementById('logSymptomModal'));
            modal.hide();
        }, 1500);
    })
    .catch(error => {
        console.error('Error logging symptom:', error);
        const errorMsg = error?.detail || error?.message || 'Failed to log symptom';
        showResponse(errorMsg, 'danger');
    });
}

function callEmergency() {
    // This would ideally call the first emergency contact or a default number
    const emergencyContacts = document.querySelectorAll('#emergencyContactsList a[href^="tel:"]');
    if (emergencyContacts.length > 0) {
        window.location.href = emergencyContacts[0].getAttribute('href');
    } else {
        // Fallback to a general emergency number (US: 911, UK: 999, etc.)
        window.location.href = 'tel:911';
    }
}

function showResponse(message, type) {
    const responseElement = document.getElementById('symptomResponse');
    responseElement.style.display = 'block';
    responseElement.innerHTML = `
        <div class="alert alert-${type} alert-dismissible fade show" role="alert">
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    `;
}

function showLoginPrompt(elementId) {
    const container = document.getElementById(elementId);
    container.innerHTML = `
        <div class="alert alert-danger">
            Please <a href="/login/" class="alert-link">log in</a> to access this feature.
        </div>
    `;
}
</script>


<!-- Optimized Modal with Proper Scrolling -->
<div class="modal fade" id="accountModal" tabindex="-1" aria-labelledby="accountModalLabel">
  <div class="modal-dialog modal-dialog-centered modal-lg" style="max-width: 700px;">
    <div class="modal-content" style="box-shadow: 0 15px 40px rgba(0,0,0,0.1); border: none; border-radius: 16px; overflow: hidden; max-height: 90vh; display: flex; flex-direction: column;">
      
      <!-- Header -->
      <div class="modal-header" style="background-color: #FFFBF5; border-bottom: 1px solid rgba(0,0,0,0.05); padding: 1.5rem 2rem; flex-shrink: 0;">
        <h5 class="modal-title" id="accountModalLabel" style="font-weight: 600; color: #5D4B36; font-size: 1.4rem;">My Account</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="this.blur();"></button>

      </div>
      
      <!-- Scrollable Body -->
      <div class="modal-body" style="background-color: #FFFBF5; padding: 0 2rem; font-family: 'Segoe UI', -apple-system, sans-serif; overflow-y: auto; flex-grow: 1;">
        
        <!-- Profile Header -->
        <div class="profile-header">
          
          <div>
            <h2 id="userFullName" style="font-weight: 700; color: #333; margin-bottom: 0.25rem; letter-spacing: 0.3px;">Loading...</h2>
            
            <div style="display: flex; gap: 1rem;">
              <button id="editProfileBtn" class="btn" style="background-color: #8B7355; color: white; border: none; padding: 0.5rem 1.25rem; border-radius: 8px; font-weight: 500; font-size: 0.9rem;">
                <i class="fas fa-edit me-2"></i>Edit Profile
              </button>
              
            </div>
          </div>
        </div>

        <!-- Two-Column Layout -->
        <div class="row" style="margin-bottom: 2rem;">
          <!-- Left Column -->
          <div class="col-md-6" style="padding-right: 1.5rem;">
            <div class="info-section" style="margin-bottom: 2rem;">
              <h4 style="font-weight: 600; color: #5D4B36; margin-bottom: 1.25rem; font-size: 1.1rem; display: flex; align-items: center;">
                <i class="fas fa-user-circle me-2" style="color: #8B7355; font-size: 1.1rem;"></i>
                Personal Information
              </h4>
              <div class="info-item" style="margin-bottom: 1rem;">
                <div style="font-weight: 500; color: #777; font-size: 0.9rem; margin-bottom: 0.25rem;">Full Name:</div>
                <div id="userFullNameInfo" style="color: #333; font-size: 0.95rem;">Loading...</div>
              </div>
              <div class="info-item" style="margin-bottom: 1rem;">
                <div style="font-weight: 500; color: #777; font-size: 0.9rem; margin-bottom: 0.25rem;">Date of Birth:</div>
                <div id="userDob" style="color: #333; font-size: 0.95rem;">--</div>
              </div>
             
              <div class="info-item">
                <div style="font-weight: 500; color: #777; font-size: 0.9rem; margin-bottom: 0.25rem;">Blood Type:</div>
                <div id="userBloodType" style="color: #333; font-size: 0.95rem;">--</div>
              </div>
            </div>
          </div>
          
          <!-- Right Column -->
          <div class="col-md-6" style="padding-left: 1.5rem;">
            <div class="info-section" style="margin-bottom: 2rem;">
              <h4 style="font-weight: 600; color: #5D4B36; margin-bottom: 1.25rem; font-size: 1.1rem; display: flex; align-items: center;">
                <i class="fas fa-address-card me-2" style="color: #8B7355; font-size: 1.1rem;"></i>
                Contact Information
              </h4>
              <div class="info-item" style="margin-bottom: 1rem;">
                <div style="font-weight: 500; color: #777; font-size: 0.9rem; margin-bottom: 0.25rem;">Email:</div>
                <div id="userEmail" style="color: #333; font-size: 0.95rem;">Loading...</div>
              </div>
              <div class="info-item" style="margin-bottom: 1rem;">
                <div style="font-weight: 500; color: #777; font-size: 0.9rem; margin-bottom: 0.25rem;">Phone:</div>
                <div id="userPhone" style="color: #333; font-size: 0.95rem;">--</div>
              </div>
              <div class="info-item" style="margin-bottom: 1rem;">
                <div style="font-weight: 500; color: #777; font-size: 0.9rem; margin-bottom: 0.25rem;">Address:</div>
                <div id="userAddress" style="color: #333; font-size: 0.95rem;">--</div>
              </div>
            </div>

            <div class="info-section">
              <h4 style="font-weight: 600; color: #5D4B36; margin-bottom: 1.25rem; font-size: 1.1rem; display: flex; align-items: center;">
                <i class="fas fa-shield-alt me-2" style="color: #8B7355; font-size: 1.1rem;"></i>
                Account Security
              </h4>
              <div class="info-item" style="margin-bottom: 1rem;">
                <div style="font-weight: 500; color: #777; font-size: 0.9rem; margin-bottom: 0.25rem;">Password:</div>
                <div style="color: #333; font-size: 0.95rem;">
                  ********** 
                  <a href="#" id="changePasswordBtn" style="color: #8B7355; text-decoration: none; margin-left: 0.5rem; font-weight: 500;"></a>
                </div>
              </div>
              <div class="info-item">
                <div style="font-weight: 500; color: #777; font-size: 0.9rem; margin-bottom: 0.25rem;">Last Login:</div>
                <div id="lastLogin" style="color: #333; font-size: 0.95rem;">--</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Footer with Close Button -->
      <div class="modal-footer" style="background-color: #FFFBF5; border-top: 1px solid rgba(0,0,0,0.05); padding: 1.25rem 2rem; flex-shrink: 0; display: flex; justify-content: flex-end;">
        <button 
  type="button" 
  class="btn" 
  style="background-color: #8B7355; color: white; border: none; padding: 0.6rem 1.5rem; border-radius: 8px; font-weight: 500;" 
  data-bs-dismiss="modal" 
  onclick="this.blur()">
  Close
</button>

      </div>
    </div>
  </div>
</div>

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="background-color: #FFFBF5; border-radius: 16px;">
      <div class="modal-header border-0">
        <h5 class="modal-title" style="font-weight: 600; color: #5D4B36;">
          <i class="fas fa-user-edit me-2"></i>Edit Profile
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="this.blur();"></button>

      </div>
      <div class="modal-body">
        <form id="profileForm">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">First Name</label>
              <input type="text" class="form-control" id="firstName" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Last Name</label>
              <input type="text" class="form-control" id="lastName" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Date of Birth</label>
              <input type="date" class="form-control" id="dob">
            </div>
            <div class="col-md-6">
              <label class="form-label">Blood Type</label>
              <select class="form-select" id="bloodType">
                <option value="">Select</option>
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
              </select>
            </div>
            <div class="col-12">
              <label class="form-label">Email</label>
              <input type="email" class="form-control" id="email" required>
            </div>
            <div class="col-12">
              <label class="form-label">Phone</label>
              <input type="tel" class="form-control" id="phone">
            </div>
            <div class="col-12">
              <label class="form-label">Address</label>
              <textarea class="form-control" id="address" rows="2"></textarea>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer border-0">
        <button 
  type="button" 
  class="btn btn-outline-secondary" 
  data-bs-dismiss="modal" 
  onclick="this.blur()">Cancel</button>

  <button type="button" class="btn text-white" id="saveProfileBtn" style="background-color: #8B7355;" onclick="this.blur();">
    Save Changes
  </button>
  
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Elements
    const accountModal = new bootstrap.Modal(document.getElementById('accountModal'));
    const editProfileModal = new bootstrap.Modal(document.getElementById('editProfileModal'));
    const editProfileBtn = document.getElementById('editProfileBtn');
    const changePasswordBtn = document.getElementById('changePasswordBtn');
    const saveProfileBtn = document.getElementById('saveProfileBtn');
    const profileForm = document.getElementById('profileForm');
    
    // Format date for display
    function formatDate(dateString) {
        if (!dateString) return '--';
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return new Date(dateString).toLocaleDateString(undefined, options);
    }
    
    // Get user initials for avatar
    function getUserInitials(firstName, lastName) {
      return (firstName?.charAt(0) + (lastName?.charAt(0) || 'JD')).toUpperCase();

    }
    
    // Fetch user profile from API
    async function fetchUserProfile() {
        try {
            const token = localStorage.getItem('access_token');
            const response = await fetch('https://healthtrack.pythonanywhere.com/api/profile/', {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });
            
            if (!response.ok) {
                throw new Error('Failed to fetch profile');
            }
            
            const userData = await response.json();
            renderUserProfile(userData);
        } catch (error) {
            console.error('Error fetching user profile:', error);
            alert('Failed to load profile. Please try again.');
        }
    }
    
    // Render user profile data
    function renderUserProfile(user) {
        // Avatar and name
        
        document.getElementById('userFullName').textContent = `${user.first_name || ''} ${user.last_name || ''}`.trim() || 'User';
        document.getElementById('userFullNameInfo').textContent = `${user.first_name || ''} ${user.last_name || ''}`.trim() || '--';
        
      
        
        // Personal info
        document.getElementById('userDob').textContent = formatDate(user.date_of_birth);
        document.getElementById('userBloodType').textContent = user.blood_type || '--';
        
        // Contact info
        document.getElementById('userEmail').textContent = user.email || '--';
        document.getElementById('userPhone').textContent = user.phone_number || '--';
        document.getElementById('userAddress').textContent = user.address || '--';
        
        // Last login (mock data)
        document.getElementById('lastLogin').textContent = 'Today, ' + new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) + ' from Chrome on ' + (navigator.platform.includes('Win') ? 'Windows' : 'Mac');
        
        // Populate edit form
        document.getElementById('firstName').value = user.first_name || '';
        document.getElementById('lastName').value = user.last_name || '';
        document.getElementById('dob').value = user.date_of_birth || '';
        document.getElementById('bloodType').value = user.blood_type || '';
        document.getElementById('email').value = user.email || '';
        document.getElementById('phone').value = user.phone_number || '';
        document.getElementById('address').value = user.address || '';
    }
    
    // Handle edit profile button
    editProfileBtn.addEventListener('click', function() {
        accountModal.hide();
        editProfileModal.show();
    });
    
    // Handle change password button
    changePasswordBtn.addEventListener('click', function(e) {
        e.preventDefault();
        alert('Password change functionality would be implemented here');
    });
    
    // Handle save profile
    saveProfileBtn.addEventListener('click', async function() {
        const token = localStorage.getItem('access_token');
        const formData = {
            first_name: document.getElementById('firstName').value,
            last_name: document.getElementById('lastName').value,
            date_of_birth: document.getElementById('dob').value || null,
            blood_type: document.getElementById('bloodType').value || '',
            email: document.getElementById('email').value,
            phone_number: document.getElementById('phone').value || '',
            address: document.getElementById('address').value || ''
        };
        
        try {
            const response = await fetch('https://healthtrack.pythonanywhere.com/api/profile/', {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            });
            
            if (!response.ok) {
                throw new Error('Failed to update profile');
            }
            
            const updatedUser = await response.json();
            editProfileModal.hide();
            fetchUserProfile(); // Refresh the profile data
            accountModal.show();
        } catch (error) {
            console.error('Error updating profile:', error);
            alert('Failed to update profile. Please try again.');
        }
    });
    
    // When account modal is shown, fetch profile data
    document.getElementById('accountModal').addEventListener('shown.bs.modal', fetchUserProfile);
});
</script>

<style>
  /* Smooth hover effects */
  .info-section {
    transition: all 0.3s ease;
    padding: 1.5rem;
    background-color: rgba(255,255,255,0.7);
    border-radius: 12px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.03);
  }
  
  .info-section:hover {
    background-color: white;
    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
    transform: translateY(-2px);
  }
  
  .btn {
    transition: all 0.3s ease;
  }
  
  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(139, 115, 85, 0.2);
  }
  
  .account-avatar {
    transition: all 0.3s ease;
  }
  
  .account-avatar:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
  }
  
  /* Custom scrollbar for modal body */
  .modal-body::-webkit-scrollbar {
    width: 6px;
  }
  
  .modal-body::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
  }
  
  .modal-body::-webkit-scrollbar-thumb {
    background: #C4A484;
    border-radius: 10px;
  }
  
  .modal-body::-webkit-scrollbar-thumb:hover {
    background: #8B7355;
  }
  /* Hide avatar on small screens */
@media (max-width: 575px) {
  .account-avatar {
    display: none;
  }
}

</style>
<script>
  function openAccountModal() {
  // Show the modal when clicked
  var myModal = new bootstrap.Modal(document.getElementById('accountModal'));
  myModal.show();
}

</script>

<style>
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .modal-dialog {
      margin: 1rem auto;
    }
    .card-body {
      padding: 1.5rem !important;
    }
    .btn-lg {
      padding: 0.5rem 1rem !important;
      font-size: 1rem;
    }
  }
  
  /* Enhanced input focus state */
  .form-control:focus {
    box-shadow: 0 0 0 0.25rem rgba(196, 169, 124, 0.25) !important;
    border-color: #c4a97c !important;
  }
  
  /* Better switch styling */
  .form-check-input:checked {
    background-color: #c4a97c !important;
    border-color: #b39a70 !important;
  }
</style>



<!-- Floating Action Button -->
<div class="fab"
     data-bs-toggle="modal"
     data-bs-target="#aiAssistantModal"
     title="AI Assistant"
     style="position: fixed; bottom: 30px; right: 30px; width: 64px; height: 64px; background-color: #fffdf8; border-radius: 50%; box-shadow: 0 4px 12px rgba(0,0,0,0.25); display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 1050;">
  <img src="https://cdn-icons-png.flaticon.com/512/4712/4712038.png"
       alt="AI Avatar"
       style="width: 38px; height: 38px;" />
</div>

<!-- AI Assistant Modal -->
<div class="modal fade" id="aiAssistantModal" tabindex="-1" aria-labelledby="aiAssistantLabel">

  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content" style="border-radius: 1rem; background-color: #fffdf8; color: #000;">
      <div class="modal-header">
        <h5 class="modal-title" id="aiAssistantLabel">AI Assistant</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
          style="filter: none; opacity: 1;"></button>
      </div>

      <div class="modal-body d-flex flex-column gap-2" style="max-height: 400px; overflow-y: auto;" id="chatContainer">
        <div class="chat-message bot">
           Hello! I'm your virtual assistant.
        </div>
        <div class="chat-message bot">
           How can I help you today?
        </div>
      </div>

      <div class="modal-footer d-flex" style="gap: 10px;">
        <input type="text" id="userInput" class="form-control" placeholder="Type your message..."
          style="flex: 1; background-color: #fff; color: #000; border: 1px solid #ccc;">
        <button class="btn" onclick="sendMessage()" style="background-color: #fffdf8; color: #000; border: 1px solid #ccc;">
          Send
        </button>
      </div>
      
    </div>
  </div>
</div>


<!-- JavaScript -->
<script>
  function sendMessage() {
    const input = document.getElementById("userInput");
    const chat = document.getElementById("chatContainer");

    const userText = input.value.trim();
    if (!userText) return;

    const userMsg = document.createElement("div");
    userMsg.className = "chat-message user";
    userMsg.innerHTML = `<strong>You:</strong> ${userText}`;
    chat.appendChild(userMsg);

    input.value = "";
    chat.scrollTop = chat.scrollHeight;

    setTimeout(() => {
      const botMsg = document.createElement("div");
      botMsg.className = "chat-message bot";
      botMsg.innerHTML = `<strong>Assistant:</strong> I'm here to help!  (This is a demo response.)`;
      chat.appendChild(botMsg);
      chat.scrollTop = chat.scrollHeight;
    }, 900);
  }
  
</script>

<!-- Styles -->
<style>
  /* Enforce dark text everywhere in the modal */
  #aiAssistantModal,
  #aiAssistantModal * {
    color: #000 !important;
    fill: #000 !important;
  }

  .chat-message {
    padding: 10px 14px;
    border-radius: 12px;
    max-width: 85%;
    margin-bottom: 8px;
    font-size: 15px;
  }

  .chat-message.user {
    background-color: #e6f7ff;
    align-self: flex-end;
    text-align: right;
  }

  .chat-message.bot {
    background-color: #f0f0f0;
    align-self: flex-start;
  }
</style>




<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // Initialize tooltips
  document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // Animate cards on scroll
    const cards = document.querySelectorAll('.card');
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = 1;
          entry.target.style.transform = 'translateY(0)';
        }
      });
    }, { threshold: 0.1 });
    
    cards.forEach(card => {
      card.style.opacity = 0;
      card.style.transform = 'translateY(20px)';
      card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
      observer.observe(card);
    });
    
    // Form submission
    document.getElementById('checkinForm').addEventListener('submit', function(e) {
      e.preventDefault();
      // Show success animation
      const submitBtn = this.querySelector('button[type="submit"]');
      submitBtn.innerHTML = '<i class="fas fa-check me-2"></i>Submitted!';
      submitBtn.classList.add('btn-success');
      submitBtn.classList.remove('btn-custom');
      
      // Reset after 2 seconds
      setTimeout(() => {
        submitBtn.innerHTML = '<i class="fas fa-paper-plane me-2"></i>Submit Check-In';
        submitBtn.classList.remove('btn-success');
        submitBtn.classList.add('btn-custom');
      }, 2000);
    });

    // Sidebar toggle
   

    // Theme toggle
   

    // Navigation between pages
    const menuItems = document.querySelectorAll('.menu-item');
    const dashboardContent = document.getElementById('dashboardContent');
    const accountContent = document.getElementById('accountContent');
    
    menuItems.forEach(item => {
      item.addEventListener('click', function(e) {
        e.preventDefault();
        
        // Remove active class from all items
        menuItems.forEach(i => i.classList.remove('active'));
        
        // Add active class to clicked item
        this.classList.add('active');
        
        // Show the appropriate content
        if (this.getAttribute('href') === '#account') {
          dashboardContent.style.display = 'none';
          accountContent.style.display = 'block';
          document.querySelector('.page-title').textContent = 'Account';
        } else {
          dashboardContent.style.display = 'block';
          accountContent.style.display = 'none';
          document.querySelector('.page-title').textContent = 'Dashboard';
        }
      });
    });

    // Mobile menu toggle
    const mobileMenuBtn = document.createElement('button');
    mobileMenuBtn.className = 'btn btn-primary mobile-menu-btn d-lg-none';
    mobileMenuBtn.style.position = 'fixed';
    mobileMenuBtn.style.bottom = '20px';
    mobileMenuBtn.style.left = '20px';
    mobileMenuBtn.style.zIndex = '1000';
    mobileMenuBtn.style.width = '50px';
    mobileMenuBtn.style.height = '50px';
    mobileMenuBtn.style.borderRadius = '50%';
    mobileMenuBtn.style.display = 'none';
   
    
  
    
    mobileMenuBtn.addEventListener('click', function() {
      sidebar.classList.toggle('sidebar-mobile-show');
    });

    // Show/hide mobile menu button based on screen size
    function checkScreenSize() {
      if (window.innerWidth < 992) {
        mobileMenuBtn.style.display = 'flex';
        mobileMenuBtn.style.alignItems = 'center';
        mobileMenuBtn.style.justifyContent = 'center';
        sidebar.classList.add('sidebar-collapsed');
      } else {
        mobileMenuBtn.style.display = 'none';
        sidebar.classList.remove('sidebar-collapsed');
      }
    }
    
    window.addEventListener('resize', checkScreenSize);
    checkScreenSize();
  });
  
  function updateEnergyValue(value) {
    document.getElementById('energyValue').textContent = value;
    
    // Change color based on value
    const energyValue = document.getElementById('energyValue');
    if (value < 4) {
      energyValue.style.color = 'var(--danger)';
    } else if (value < 7) {
      energyValue.style.color = 'var(--warning)';
    } else {
      energyValue.style.color = 'var(--success)';
    }
  }
  
  // Initialize with default energy value
  updateEnergyValue(5);
</script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // ... keep previous tooltip and card animation code ...

    // Remove the sidebar toggle functionality since we're removing the button
    const toggleSidebar = document.getElementById('toggleSidebar');
    if (toggleSidebar) {
      toggleSidebar.remove();
    }

    // Mobile menu toggle - keep this if you want mobile navigation
    
    
   

    // Show/hide mobile menu button based on screen size
   

    // ... rest of your existing JavaScript ...
  });
</script>
<style>
  /* Add these styles to fix sidebar functionality */
  @media (max-width: 992px) {
    .sidebar {
      transform: translateX(-100%);
      transition: transform var(--transition-speed);
    }
    
    .sidebar.sidebar-mobile-show {
      transform: translateX(0);
    }
    
    .mobile-menu-btn {
      display: flex !important;
      align-items: center;
      justify-content: center;
    }
  }
</style>
<script>
  // Updated JavaScript to fix sidebar functionality
  document.addEventListener('DOMContentLoaded', function() {
    // ... keep previous tooltip and card animation code ...

    // Sidebar toggle - fixed functionality
    
   // Mobile menu toggle - fixed functionality
const mobileMenuBtn = document.createElement('button');
mobileMenuBtn.className = 'btn btn-primary mobile-menu-btn d-lg-none';
mobileMenuBtn.style.position = 'fixed';
mobileMenuBtn.style.bottom = '20px';
mobileMenuBtn.style.left = '20px';
mobileMenuBtn.style.zIndex = '1000';
mobileMenuBtn.style.width = '50px';
mobileMenuBtn.style.height = '50px';
mobileMenuBtn.style.borderRadius = '50%';
mobileMenuBtn.style.display = 'none';






// Close sidebar when clicking outside on mobile
document.addEventListener('click', function (e) {
  if (
    window.innerWidth < 992 &&
    !sidebar.contains(e.target) &&
    e.target !== mobileMenuBtn &&
    !mobileMenuBtn.contains(e.target)
  ) {
    sidebar.classList.remove('sidebar-mobile-show');
  }
});

function checkScreenSize() {
  const mainContent = document.querySelector('.main-content');

  if (window.innerWidth < 992) {
    mobileMenuBtn.style.display = 'flex';
    
    // Shrink sidebar
  
    // NEW: Add a class for small width
    sidebar.classList.remove('sidebar-collapsed');
    if (mainContent) {
  mainContent.style.marginLeft = '';
}

  } else {
    mobileMenuBtn.style.display = 'none';
    
    sidebar.classList.remove('sidebar-collapsed');
    sidebar.classList.remove('sidebar-icons-only');

    if (mainContent) {
      mainContent.style.marginLeft = '0';
    }
  }
}

window.addEventListener('resize', checkScreenSize);
checkScreenSize();



   
  });
</script>
<style>
  .sidebar-icons-only {
  width: 60px; /* or 50px, adjust as needed */
  overflow: hidden;
}

.sidebar-icons-only .nav-text {
  display: none; /* hide labels, keep icons only */
}
.sidebar-icons-only .sidebar-header {
  display: none; /* Hide the "Healthtrack" header */
}
.sidebar-icons-only .sidebar-header {
  width: 100%;
  text-align: center;
  font-size: 0; /* hide text */
}

.sidebar-icons-only .sidebar-header i {
  font-size: 24px; /* show icon if present */
}



</style>
<style>
  #sidebar {
  position: fixed;
  top: 20px;
  left: 20px;
  background-color: #fffdf5;
  color: #222;
  border-radius: 25px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 20px;
  width: 180px;
  max-height: calc(100vh - 40px); /* Leaves 20px top & bottom spacing */
  overflow-y: auto;
  transition: all 0.3s ease;
  z-index: 1040;
}

@media (max-width: 768px) {
  #sidebar {
    width: 60px;
    left: 10px;
    top: 15px;
    padding: 15px;
    border-radius: 20px;
    max-height: calc(100vh - 30px); /* Leaves 15px top & bottom spacing */
  }
}

</style>
<style>
@media (max-width: 991.98px) {
  #sidebar {
    display: none !important;
  }
}

</style>

<!-- Back to Top Button -->
<button onclick="scrollToTop()" id="backToTopBtn">
  <i class="fas fa-arrow-circle-up"></i>
</button>

<style>
  #backToTopBtn {
    position: fixed;
    bottom: 20px;
    left: 20px;
    z-index: 1000;
    background: rgba(0, 123, 255, 0.7);
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    font-size: 24px;
    color: white;
    cursor: pointer;
    display: none;
    transition: all 0.3s ease;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
  }

  #backToTopBtn:hover {
    background: rgba(0, 86, 179, 0.9);
    transform: scale(1.1);
  }

  #backToTopBtn:focus {
    outline: none;
  }

  /* Hide on desktop screens */
  @media (min-width: 1025px) {
    #backToTopBtn {
      display: none !important;
    }
  }
</style>

<script>
  // Only run this code on mobile devices
  function isMobile() {
    return window.innerWidth <= 1024;
  }

  window.onscroll = function() {
    if (!isMobile()) return;
    
    const btn = document.getElementById("backToTopBtn");
    const scrollPosition = window.innerHeight + window.scrollY;
    const pageHeight = document.body.offsetHeight;
    
    // Show button when scrolled to bottom (with 50px threshold)
    btn.style.display = (scrollPosition >= pageHeight - 50) ? "block" : "none";
  };

  function scrollToTop() {
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  // Also check on window resize
  window.addEventListener('resize', function() {
    if (!isMobile()) {
      document.getElementById("backToTopBtn").style.display = 'none';
    }
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>



<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Create improved toast notification function
    function showToast(message, isSuccess = true) {
        const toast = document.createElement('div');
        toast.style.position = 'fixed';
        toast.style.bottom = '24px';
        toast.style.right = '24px';
        toast.style.padding = '12px 20px';
        toast.style.backgroundColor = isSuccess ? '#4CAF50' : '#f44336';
        toast.style.color = 'white';
        toast.style.borderRadius = '8px';
        toast.style.boxShadow = '0 2px 10px rgba(0,0,0,0.15)';
        toast.style.zIndex = '1000';
        toast.style.fontFamily = 'Arial, sans-serif';
        toast.style.fontSize = '14px';
        toast.style.fontWeight = '500';
        toast.style.lineHeight = '1.5';
        toast.style.opacity = '0';
        toast.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
        toast.style.transform = 'translateY(20px)';
        toast.style.maxWidth = '300px';
        toast.style.wordBreak = 'break-word';
        toast.textContent = message;
        
        document.body.appendChild(toast);
        
        // Trigger the animation
        setTimeout(() => {
            toast.style.opacity = '1';
            toast.style.transform = 'translateY(0)';
        }, 10);
        
        // Remove after timeout
        setTimeout(() => {
            toast.style.opacity = '0';
            toast.style.transform = 'translateY(-20px)';
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 300);
        }, 2500); // Reduced timeout to 2.5 seconds total (0.3s fade out at end)
    }

    // No need for separate CSS animations with this approach
});
  
</script>




</body>
</html>
                    