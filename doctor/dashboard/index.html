<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthTrack | Doctor Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --cream-primary: #FFF9F0;
            --cream-secondary: #F5EDE0;
            --cream-tertiary: #EAE2D5;
            --accent-teal: #4E9F9F;
            --accent-teal-dark: #3A7B7B;
            --accent-teal-light: #7FC2C2;
            --text-dark: #2D3748;
            --text-medium: #4A5568;
            --text-light: #718096;
            --white: #FFFFFF;
            --success: #48BB78;
            --warning: #ED8936;
            --danger: #F56565;
            --info: #4299E1;
            --sidebar-width: 280px;
            --transition-speed: 0.3s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--cream-primary);
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* ========== Sidebar ========== */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--accent-teal);
            color: var(--white);
            position: fixed;
            height: 100vh;
            transition: all var(--transition-speed) ease;
            z-index: 100;
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 25px 20px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            font-size: 1.8rem;
            color: var(--white);
        }

        .logo-text {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--white);
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-category {
            padding: 10px 20px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 10px;
        }

        .nav-item {
            margin: 5px 0;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
        }

        .nav-link.active {
            background: rgba(255, 255, 255, 0.15);
            border-left: 3px solid var(--white);
            color: var(--white);
        }

        .nav-link i {
            width: 24px;
            font-size: 1.1rem;
            margin-right: 12px;
            text-align: center;
        }

        .nav-text {
            font-size: 0.95rem;
            font-weight: 500;
        }

        /* ========== Main Content ========== */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: all var(--transition-speed) ease;
            padding: 30px;
            min-height: 100vh;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--accent-teal-dark);
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--accent-teal);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .user-avatar:hover {
            transform: scale(1.05);
        }

        .user-name {
            font-weight: 500;
            color: var(--text-dark);
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--accent-teal);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: color 0.2s ease;
        }

        .logout-btn:hover {
            color: var(--accent-teal-dark);
        }

        /* Dashboard Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--white);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--white);
        }

        .icon-today {
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-teal-light));
        }

        .icon-upcoming {
            background: linear-gradient(135deg, var(--warning), #F6AD55);
        }

        .icon-patients {
            background: linear-gradient(135deg, var(--success), #68D391);
        }

        .stat-title {
            font-size: 1rem;
            color: var(--text-medium);
            font-weight: 500;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--text-dark);
            margin: 5px 0;
        }

        .stat-details {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .appointment-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-top: 10px;
            background: var(--cream-secondary);
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .appointment-item:hover {
            background: var(--cream-tertiary);
        }

        .appointment-time {
            font-weight: 500;
            min-width: 80px;
            color: var(--accent-teal-dark);
        }

        .appointment-patient {
            flex: 1;
            font-weight: 500;
        }

        /* Patients Section */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0 20px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent-teal-dark);
        }

        .view-all {
            color: var(--accent-teal);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: color 0.2s ease;
        }

        .view-all:hover {
            color: var(--accent-teal-dark);
        }

        .patients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .patient-card {
            background: var(--white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .patient-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .patient-header {
            padding: 20px;
            background: var(--cream-secondary);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .patient-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--accent-teal);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.2rem;
        }

        .patient-info {
            flex: 1;
        }

        .patient-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 3px;
        }

        .patient-age {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .patient-details {
            padding: 15px 20px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .detail-label {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .detail-value {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-dark);
        }

        /* Appointments Table */
        .appointments-table-container {
            background: var(--white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-top: 20px;
        }

        .table-responsive {
            overflow-x: auto;
        }

        .appointments-table {
            width: 100%;
            border-collapse: collapse;
        }

        .appointments-table th {
            background: var(--accent-teal);
            color: var(--white);
            font-weight: 500;
            padding: 15px;
            text-align: left;
        }

        .appointments-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--cream-secondary);
        }

        .appointments-table tr:last-child td {
            border-bottom: none;
        }

        .appointments-table tr:hover {
            background: var(--cream-secondary);
        }

        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-upcoming {
            background: rgba(237, 137, 54, 0.1);
            color: var(--warning);
        }

        .status-completed {
            background: rgba(72, 187, 120, 0.1);
            color: var(--success);
        }

        .status-cancelled {
            background: rgba(245, 101, 101, 0.1);
            color: var(--danger);
        }

        /* Patient Details Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--white);
            border-radius: 12px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            transition: color 0.2s ease;
            background: none;
            border: none;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-modal:hover {
            color: var(--danger);
            background: rgba(245, 101, 101, 0.1);
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--cream-secondary);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent-teal-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-body {
            padding: 25px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .info-card {
            background: var(--cream-primary);
            border-radius: 10px;
            padding: 20px;
        }

        .info-card-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--accent-teal-dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-item {
            margin-bottom: 12px;
        }

        .info-label {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 3px;
        }

        .info-value {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-dark);
        }

        /* Profile View */
        .profile-card {
            background: var(--white);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--accent-teal);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: 600;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        .profile-specialty {
            font-size: 1rem;
            color: var(--accent-teal-dark);
            font-weight: 500;
        }

        .profile-details {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .detail-group {
            margin-bottom: 20px;
        }

        .detail-group-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--accent-teal-dark);
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--cream-secondary);
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                width: 100%;
            }

            .menu-toggle {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 20px;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .user-actions {
                width: 100%;
                justify-content: space-between;
            }

            .profile-header {
                flex-direction: column;
                text-align: center;
            }

            .profile-avatar {
                margin-bottom: 15px;
            }
        }

        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .patients-grid {
                grid-template-columns: 1fr;
            }

            .profile-details {
                grid-template-columns: 1fr;
            }
        }

        /* Menu Toggle Button (for mobile) */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--accent-teal-dark);
            cursor: pointer;
            margin-right: 15px;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(78, 159, 159, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-teal);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-heartbeat"></i>
                    </div>
                    <div class="logo-text">MediCare Pro</div>
                </div>
            </div>

            <div class="sidebar-menu">
                <div class="menu-category">Main Menu</div>
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="" class="nav-link active" id="dashboard-link">
                            <i class="fas fa-tachometer-alt"></i>
                            <span class="nav-text">Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="" class="nav-link" id="patients-link">
                            <i class="fas fa-user-injured"></i>
                            <span class="nav-text">Patients</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="" class="nav-link" id="appointments-link">
                            <i class="fas fa-calendar-check"></i>
                            <span class="nav-text">Appointments</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="" class="nav-link" id="profile-link">
                            <i class="fas fa-user-md"></i>
                            <span class="nav-text">Profile</span>
                        </a>
                    </li>
                </ul>

                <div class="menu-category">Tools</div>
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="" class="nav-link">
                            <i class="fas fa-prescription"></i>
                            <span class="nav-text">Prescriptions</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="" class="nav-link">
                            <i class="fas fa-file-medical"></i>
                            <span class="nav-text">Reports</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="" class="nav-link">
                            <i class="fas fa-chart-line"></i>
                            <span class="nav-text">Analytics</span>
                        </a>
                    </li>
                </ul>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="main-content">
            <!-- Dashboard View -->
            <div id="dashboard-view">
                <div class="header">
                    <button class="menu-toggle" id="menu-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="page-title">Doctor Dashboard</h1>
                    <div class="user-actions">
                        <div class="user-profile">
                            <div class="user-avatar" id="user-avatar">DR</div>
                            <div class="user-name" id="user-name">Dr. Name</div>
                        </div>
                        <button class="logout-btn" id="logout-btn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-title">Today's Appointments</div>
                                <div class="stat-value" id="today-appointments-count">0</div>
                            </div>
                            <div class="stat-icon icon-today">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                        </div>
                        <div class="stat-details" id="today-appointments-list">
                            <div class="loading"></div> Loading appointments...
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-title">Upcoming Appointments</div>
                                <div class="stat-value" id="upcoming-appointments-count">0</div>
                            </div>
                            <div class="stat-icon icon-upcoming">
                                <i class="fas fa-calendar-week"></i>
                            </div>
                        </div>
                        <div class="stat-details" id="upcoming-appointments-list">
                            <div class="loading"></div> Loading appointments...
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-title">Active Patients</div>
                                <div class="stat-value" id="active-patients-count">0</div>
                            </div>
                            <div class="stat-icon icon-patients">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="stat-details">
                            <span id="new-patients">0</span> new this month
                        </div>
                    </div>
                </div>

                <div class="section-header">
                    <h2 class="section-title">Recent Patients</h2>
                    <a href="" class="view-all" id="view-all-patients">
                        View All <i class="fas fa-chevron-right"></i>
                    </a>
                </div>

                <div class="patients-grid" id="recent-patients">
                    <!-- Patient cards will be inserted here -->
                    <div class="loading" style="grid-column: 1 / -1; text-align: center; padding: 30px;">
                        <div class="loading"></div> Loading patients...
                    </div>
                </div>
            </div>

            <!-- Patients View -->
            <div id="patients-view" style="display: none;">
                <div class="header">
                    <button class="menu-toggle" id="menu-toggle-2">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="page-title">Patient Management</h1>
                    <div class="user-actions">
                        <div class="user-profile">
                            <div class="user-avatar" id="user-avatar-2">DR</div>
                            <div class="user-name" id="user-name-2">Dr. Name</div>
                        </div>
                        <button class="logout-btn" id="logout-btn-2">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>

                <div class="section-header">
                    <h2 class="section-title">All Patients</h2>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search patients..." id="patient-search">
                    </div>
                </div>

                <div class="patients-grid" id="all-patients">
                    <!-- All patient cards will be inserted here -->
                    <div class="loading" style="grid-column: 1 / -1; text-align: center; padding: 30px;">
                        <div class="loading"></div> Loading patients...
                    </div>
                </div>
            </div>

            <!-- Appointments View -->
            <div id="appointments-view" style="display: none;">
                <div class="header">
                    <button class="menu-toggle" id="menu-toggle-3">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="page-title">Appointment Schedule</h1>
                    <div class="user-actions">
                        <div class="user-profile">
                            <div class="user-avatar" id="user-avatar-3">DR</div>
                            <div class="user-name" id="user-name-3">Dr. Name</div>
                        </div>
                        <button class="logout-btn" id="logout-btn-3">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>

                <div class="section-header">
                    <h2 class="section-title">Upcoming Appointments</h2>
                    <button class="btn-primary" id="new-appointment-btn">
                        <i class="fas fa-plus"></i> New Appointment
                    </button>
                </div>

                <div class="appointments-table-container">
                    <div class="table-responsive">
                        <table class="appointments-table" id="appointments-table">
                            <thead>
                                <tr>
                                    <th>Patient</th>
                                    <th>Date & Time</th>
                                    <th>Purpose</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="appointments-list">
                                <!-- Appointments will be inserted here -->
                                <tr>
                                    <td colspan="5" style="text-align: center; padding: 30px;">
                                        <div class="loading"></div> Loading appointments...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Profile View -->
            <div id="profile-view" style="display: none;">
                <div class="header">
                    <button class="menu-toggle" id="menu-toggle-4">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="page-title">My Profile</h1>
                    <div class="user-actions">
                        <div class="user-profile">
                            <div class="user-avatar" id="user-avatar-4">DR</div>
                            <div class="user-name" id="user-name-4">Dr. Name</div>
                        </div>
                        <button class="logout-btn" id="logout-btn-4">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>

                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profile-avatar">DR</div>
                        <div class="profile-info">
                            <h1 class="profile-name" id="profile-name">Loading...</h1>
                            <div class="profile-specialty" id="profile-specialty">Loading...</div>
                        </div>
                    </div>

                    <div class="profile-details">
                        <div class="detail-group">
                            <h3 class="detail-group-title">
                                <i class="fas fa-info-circle"></i> Basic Information
                            </h3>
                            <div class="detail-row">
                                <div class="detail-label">Email</div>
                                <div class="detail-value" id="profile-email">loading...</div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-label">Phone</div>
                                <div class="detail-value" id="profile-phone">loading...</div>
                            </div>
                            
                        </div>

                        <div class="detail-group">
                            <h3 class="detail-group-title">
                                <i class="fas fa-briefcase-medical"></i> Professional Information
                            </h3>
                            <div class="detail-row">
                                <div class="detail-label">Specialization</div>
                                <div class="detail-value" id="profile-specialization">loading...</div>
                            </div>
                            <div class="detail-row">
                            
                        </div>

                       
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Patient Details Modal -->
    <div class="modal" id="patient-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-user-injured"></i>
                    <span id="modal-patient-name">Patient Name</span>
                </h2>
            </div>
            <div class="modal-body">
                <div class="info-grid">
                    <div class="info-card">
                        <h3 class="info-card-title">
                            <i class="fas fa-id-card"></i> Basic Information
                        </h3>
                        <div class="info-item">
                            <div class="info-label">Date of Birth</div>
                            <div class="info-value" id="patient-dob">Loading...</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Age</div>
                            <div class="info-value" id="patient-age">Loading...</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">Blood Type</div>
                            <div class="info-value" id="patient-blood">Loading...</div>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3 class="info-card-title">
                            <i class="fas fa-phone-alt"></i> Contact Information
                        </h3>
                        <div class="info-item">
                            <div class="info-label">Phone</div>
                            <div class="info-value" id="patient-phone">Loading...</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">Address</div>
                            <div class="info-value" id="patient-address">Loading...</div>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3 class="info-card-title">
                            <i class="fas fa-heartbeat"></i> Health Summary
                        </h3>
                        <div class="info-item">
                            <div class="info-label">Height</div>
                            <div class="info-value" id="patient-height">Loading...</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Weight</div>
                            <div class="info-value" id="patient-weight">Loading...</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">BMI</div>
                            <div class="info-value" id="patient-bmi">Loading...</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Allergies</div>
                            <div class="info-value" id="patient-allergies">Loading...</div>
                        </div>
                    </div>

                    <div class="info-card">
                        <h3 class="info-card-title">
                            <i class="fas fa-file-medical"></i> Medical History
                        </h3>
                        <div class="info-item">
                            <div class="info-label">Chronic Conditions</div>
                            <div class="info-value" id="patient-conditions">Loading...</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Current Medications</div>
                            <div class="info-value" id="patient-medications">Loading...</div>
                        </div>
                        
                        <div class="info-item">
                            <div class="info-label">Next Appointment</div>
                            <div class="info-value" id="patient-next-appointment">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentDoctor = null;
        let patients = [];
        let appointments = [];
        let filteredPatients = [];

        // DOM Elements
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        const menuToggle = document.getElementById('menu-toggle');
        const menuToggle2 = document.getElementById('menu-toggle-2');
        const menuToggle3 = document.getElementById('menu-toggle-3');
        const menuToggle4 = document.getElementById('menu-toggle-4');

        const dashboardView = document.getElementById('dashboard-view');
        const patientsView = document.getElementById('patients-view');
        const appointmentsView = document.getElementById('appointments-view');
        const profileView = document.getElementById('profile-view');

        const navLinks = {
            dashboard: document.getElementById('dashboard-link'),
            patients: document.getElementById('patients-link'),
            appointments: document.getElementById('appointments-link'),
            profile: document.getElementById('profile-link')
        };

        const viewAllPatients = document.getElementById('view-all-patients');
        const patientSearch = document.getElementById('patient-search');

        // Modal elements
        const patientModal = document.getElementById('patient-modal');
        const closeModal = document.querySelector('.close-modal');

        // Helper functions
        function getDisplayName(data) {
            if (data.full_name) return data.full_name;
            if (data.first_name || data.last_name) {
                return `${data.first_name || ''} ${data.last_name || ''}`.trim();
            }
            return 'Unknown';
        }

        function safeSetText(elementId, text) {
            const el = document.getElementById(elementId);
            if (el) el.innerText = text;
        }

        function formatDate(dateString) {
            if (!dateString) return 'Not available';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function formatDateTime(dateString) {
            if (!dateString) return 'Not scheduled';
            const date = new Date(dateString);
            return date.toLocaleString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatTime(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        function calculateAge(dateOfBirth) {
            if (!dateOfBirth) return 'Unknown';
            const birthDate = new Date(dateOfBirth);
            const ageDifMs = Date.now() - birthDate.getTime();
            const ageDate = new Date(ageDifMs);
            return Math.abs(ageDate.getUTCFullYear() - 1970);
        }

        function calculateBMI(weight, height) {
            if (!weight || !height) return 'N/A';
            // Convert height from cm to meters
            const heightInMeters = height / 100;
            return (weight / (heightInMeters * heightInMeters)).toFixed(1);
        }

        function setupEventListeners() {
            // Menu toggle for mobile
            menuToggle.addEventListener('click', toggleSidebar);
            menuToggle2.addEventListener('click', toggleSidebar);
            menuToggle3.addEventListener('click', toggleSidebar);
            menuToggle4.addEventListener('click', toggleSidebar);

            // Navigation links
            navLinks.dashboard.addEventListener('click', (e) => {
                e.preventDefault();
                showView('dashboard');
            });

            navLinks.patients.addEventListener('click', (e) => {
                e.preventDefault();
                showView('patients');
            });

            navLinks.appointments.addEventListener('click', (e) => {
                e.preventDefault();
                showView('appointments');
            });

            navLinks.profile.addEventListener('click', (e) => {
                e.preventDefault();
                showView('profile');
            });

            // View all patients link
            viewAllPatients.addEventListener('click', (e) => {
                e.preventDefault();
                showView('patients');
            });

            // Patient search
            patientSearch.addEventListener('input', filterPatients);

            // Logout buttons
            document.getElementById('logout-btn').addEventListener('click', logout);
            document.getElementById('logout-btn-2').addEventListener('click', logout);
            document.getElementById('logout-btn-3').addEventListener('click', logout);
            document.getElementById('logout-btn-4').addEventListener('click', logout);

            // Modal close
            closeModal.addEventListener('click', () => {
                patientModal.style.display = 'none';
            });

            window.addEventListener('click', (e) => {
                if (e.target === patientModal) {
                    patientModal.style.display = 'none';
                }
            });
        }

        function toggleSidebar() {
            sidebar.classList.toggle('active');
            mainContent.classList.toggle('sidebar-active');
        }

        function showView(viewName) {
            // Hide all views
            dashboardView.style.display = 'none';
            patientsView.style.display = 'none';
            appointmentsView.style.display = 'none';
            profileView.style.display = 'none';

            // Remove active class from all nav links
            Object.values(navLinks).forEach(link => {
                link.classList.remove('active');
            });

            // Show the selected view and set active nav link
            switch(viewName) {
                case 'dashboard':
                    dashboardView.style.display = 'block';
                    navLinks.dashboard.classList.add('active');
                    break;
                case 'patients':
                    patientsView.style.display = 'block';
                    navLinks.patients.classList.add('active');
                    break;
                case 'appointments':
                    appointmentsView.style.display = 'block';
                    navLinks.appointments.classList.add('active');
                    break;
                case 'profile':
                    profileView.style.display = 'block';
                    navLinks.profile.classList.add('active');
                    break;
            }

            // Close sidebar on mobile
            if (window.innerWidth < 992) {
                sidebar.classList.remove('active');
            }

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function loadDoctorProfile() {
    try {
        // Show loading state
        document.getElementById('profile-name').textContent = 'Loading...';
        document.getElementById('profile-specialty').textContent = 'Loading...';

        const response = await fetch('https://healthtrack.pythonanywhere.com/api/doctors/me', {
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
            }
        });

        if (!response.ok) throw new Error('Failed to fetch doctor profile');

        const data = await response.json();
        currentDoctor = data;

        // Log the relevant doctor profile data
        console.log('Doctor profile data:', {
            full_name: data.full_name,
            email: data.email,
            phone_number: data.phone_number,
            gender: data.gender,
            date_of_birth: data.date_of_birth,
            specialization_display: data.specialization_display,
            hospital: data.hospital,
            consultation_fee: data.consultation_fee,
            is_available: data.is_available
        });

        // Update user info in all headers
        const nameToUse = data.full_name || 'Unknown';
        const initials = nameToUse && nameToUse !== 'Unknown'
            ? nameToUse.split(' ').filter(n => n.length > 0).map(n => n[0]).join('')
            : 'DR';

        document.querySelectorAll('.user-avatar').forEach(el => {
            el.textContent = initials;
        });

        document.querySelectorAll('.user-name').forEach(el => {
            el.textContent = nameToUse;
        });

        document.getElementById('profile-avatar').textContent = initials;
        
        // Display profile information
        displayProfileInfo(data);
    } catch (error) {
        console.error('Error loading doctor profile:', error);
        alert('Failed to load doctor profile. Please try again.');
    }
}

function displayProfileInfo(data) {
    safeSetText('profile-name', data.full_name);
    safeSetText('profile-email', data.email);
    safeSetText('profile-phone', data.phone_number);
    safeSetText('profile-dob', formatDate(data.date_of_birth));
    safeSetText('profile-specialty', data.specialization_display);
    safeSetText('profile-specialization', data.specialization);
    safeSetText('profile-hospital', data.hospital);
    safeSetText('profile-consultation-fee', data.consultation_fee);
    safeSetText('profile-availability', data.is_available ? 'Available' : 'Not Available');
}


        async function loadPatients() {
            try {
                const response = await fetch('https://healthtrack.pythonanywhere.com/api/doctor/patients/', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                    }
                });

                if (!response.ok) throw new Error('Failed to fetch patients');

                patients = await response.json();
                filteredPatients = [...patients];

                // Update dashboard stats
                document.getElementById('active-patients-count').textContent = patients.length;
                
                // Calculate new patients this month (for demo purposes)
                const newPatientsCount = Math.min(patients.length, Math.floor(Math.random() * 5) + 1);
                document.getElementById('new-patients').textContent = newPatientsCount;

                // Display patients
                displayRecentPatients();
                displayAllPatients();
            } catch (error) {
                console.error('Error loading patients:', error);
                alert('Failed to load patients. Please try again.');
            }
        }

        async function loadAppointments() {
            try {
                const response = await fetch('https://healthtrack.pythonanywhere.com/api/doctor/appointments/', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                    }
                });

                if (!response.ok) throw new Error('Failed to fetch appointments');

                appointments = await response.json();
                
                // Update dashboard stats and display appointments
                updateDashboardStats();
                displayAppointmentsTable();
            } catch (error) {
                console.error('Error loading appointments:', error);
                alert('Failed to load appointments. Please try again.');
            }
        }

        function updateDashboardStats() {
            const today = new Date().toISOString().split('T')[0];
            const todaysAppointments = appointments.filter(apt => {
                return apt.appointment_date && apt.appointment_date.startsWith(today);
            });

            const upcomingAppointments = appointments.filter(apt => {
                if (!apt.appointment_date) return false;
                const aptDate = new Date(apt.appointment_date);
                const today = new Date();
                const nextYear = new Date();
                nextYear.setDate(today.getDate() + 365);
                return aptDate > today && aptDate <= nextYear;
            });

            // Update counts
            document.getElementById('today-appointments-count').textContent = todaysAppointments.length;
            document.getElementById('upcoming-appointments-count').textContent = upcomingAppointments.length;

            // Update today's appointments list
            const todayAppointmentsList = document.getElementById('today-appointments-list');
            if (todaysAppointments.length > 0) {
                todayAppointmentsList.innerHTML = todaysAppointments.slice(0, 3).map(apt => `
                    <div class="appointment-item">
                        <div class="appointment-time">${formatTime(apt.appointment_date)}</div>
                        <div class="appointment-patient">${apt.patient?.full_name || 'Unknown Patient'}</div>
                    </div>
                `).join('');
                if (todaysAppointments.length > 3) {
                    todayAppointmentsList.innerHTML += `
                        <div style="margin-top: 10px; font-size: 0.85rem; color: var(--text-light);">
                            +${todaysAppointments.length - 3} more
                        </div>
                    `;
                }
            } else {
                todayAppointmentsList.innerHTML = `
                    <div style="color: var(--text-light);">
                        <i class="fas fa-calendar-check" style="margin-right: 5px;"></i>
                        No appointments scheduled for today
                    </div>
                `;
            }

            // Update upcoming appointments list
            const upcomingAppointmentsList = document.getElementById('upcoming-appointments-list');
            if (upcomingAppointments.length > 0) {
                upcomingAppointmentsList.innerHTML = upcomingAppointments.slice(0, 3).map(apt => `
                    <div class="appointment-item">
                        <div class="appointment-time">${formatDate(apt.appointment_date)}</div>
                        <div class="appointment-patient">${apt.patient?.full_name || 'Unknown Patient'}</div>
                    </div>
                `).join('');
                if (upcomingAppointments.length > 3) {
                    upcomingAppointmentsList.innerHTML += `
                        <div style="margin-top: 10px; font-size: 0.85rem; color: var(--text-light);">
                            +${upcomingAppointments.length - 3} more
                        </div>
                    `;
                }
            } else {
                upcomingAppointmentsList.innerHTML = `
                    <div style="color: var(--text-light);">
                        <i class="fas fa-calendar-plus" style="margin-right: 5px;"></i>
                        No upcoming appointments
                    </div>
                `;
            }
        }

        function displayRecentPatients() {
    const recentPatientsContainer = document.getElementById('recent-patients');
    if (!recentPatientsContainer) return;

    const recentPatients = patients.slice(0, 4);

    if (recentPatients.length > 0) {
        recentPatientsContainer.innerHTML = recentPatients.map(patient => {
            const chronicConditions = patient.chronic_conditions?.length
                ? patient.chronic_conditions.map(cc => cc.name || cc).join(', ')
                : 'None';

            const medications = patient.medications?.length
                ? patient.medications.map(med => med.name || med).join(', ')
                : 'None';

            const symptoms = patient.symptoms?.length
                ? patient.symptoms.map(sym => sym.name || sym).join(', ')
                : 'None';

            return `
                <div class="patient-card" data-patient-id="${patient.id}">
                    <div class="patient-header">
                        <div class="patient-avatar">${getInitials(patient.full_name)}</div>
                        <div class="patient-info">
                            <h3 class="patient-name">${patient.full_name}</h3>
                            <div class="patient-age">${calculateAge(patient.date_of_birth)} years</div>
                        </div>
                    </div>
                    <div class="patient-details">
                        <div class="detail-row"><strong>Blood Type:</strong> ${patient.blood_type || 'Unknown'}</div>
                        <div class="detail-row"><strong>Address:</strong> ${patient.address || 'N/A'}</div>
                        <div class="detail-row"><strong>Phone:</strong> ${patient.phone_number || 'N/A'}</div>
                        <div class="detail-row"><strong>Chronic Conditions:</strong> ${chronicConditions}</div>
                        <div class="detail-row"><strong>Medications:</strong> ${medications}</div>
                        <div class="detail-row"><strong>Symptoms:</strong> ${symptoms}</div>
                    </div>
                </div>
            `;
        }).join('');

        // Add click event to patient cards
        document.querySelectorAll('.patient-card').forEach(card => {
            card.addEventListener('click', () => {
                const patientId = card.getAttribute('data-patient-id');
                const patient = patients.find(p => p.id == patientId);
                showPatientDetails(patient);
            });
        });

    } else {
        recentPatientsContainer.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 30px; color: var(--text-light);">
                <i class="fas fa-user-slash" style="font-size: 2rem; margin-bottom: 10px;"></i>
                <p>No recent patients found</p>
            </div>
        `;
    }
}

function displayAllPatients() {
    const allPatientsContainer = document.getElementById('all-patients');
    if (!allPatientsContainer) return;

    if (filteredPatients.length > 0) {
        allPatientsContainer.innerHTML = filteredPatients.map(patient => {
            const chronicConditions = patient.chronic_conditions?.length
                ? patient.chronic_conditions.map(cc => cc.name || cc).join(', ')
                : 'None';

            const medications = patient.medications?.length
                ? patient.medications.map(med => med.name || med).join(', ')
                : 'None';

            const symptoms = patient.symptoms?.length
                ? patient.symptoms.map(sym => sym.name || sym).join(', ')
                : 'None';

            return `
                <div class="patient-card" data-patient-id="${patient.id}">
                    <div class="patient-header">
                        <div class="patient-avatar">${getInitials(patient.full_name)}</div>
                        <div class="patient-info">
                            <h3 class="patient-name">${patient.full_name}</h3>
                            <div class="patient-age">${calculateAge(patient.date_of_birth)} years</div>
                        </div>
                    </div>
                    <div class="patient-details">
                        <div class="detail-row"><strong>Blood Type:</strong> ${patient.blood_type || 'Unknown'}</div>
                        <div class="detail-row"><strong>Address:</strong> ${patient.address || 'N/A'}</div>
                        <div class="detail-row"><strong>Phone:</strong> ${patient.phone_number || 'N/A'}</div>
                        <div class="detail-row"><strong>Chronic Conditions:</strong> ${chronicConditions}</div>
                        <div class="detail-row"><strong>Medications:</strong> ${medications}</div>
                        <div class="detail-row"><strong>Symptoms:</strong> ${symptoms}</div>
                    </div>
                </div>
            `;
        }).join('');

        // Add click event to patient cards
        document.querySelectorAll('.patient-card').forEach(card => {
            card.addEventListener('click', () => {
                const patientId = card.getAttribute('data-patient-id');
                const patient = patients.find(p => p.id == patientId);
                showPatientDetails(patient);
            });
        });

    } else {
        allPatientsContainer.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 30px; color: var(--text-light);">
                <i class="fas fa-user-slash" style="font-size: 2rem; margin-bottom: 10px;"></i>
                <p>No patients found</p>
            </div>
        `;
    }
}


        function displayAppointmentsTable() {
            const appointmentsList = document.getElementById('appointments-list');
            if (!appointmentsList) return;

            if (appointments.length > 0) {
                appointmentsList.innerHTML = appointments.map(apt => `
                    <tr>
                        <td>${apt.patient?.full_name || 'Unknown Patient'}</td>
                        <td>${formatDateTime(apt.appointment_date)}</td>
                        <td>${apt.purpose || 'General Checkup'}</td>
                        <td>
                            <span class="status-badge ${getStatusClass(apt.status)}">
                                ${getStatusText(apt.status)}
                            </span>
                        </td>
                        <td>
                            <button class="btn-action view-btn" data-appointment-id="${apt.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-action edit-btn" data-appointment-id="${apt.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            } else {
                appointmentsList.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 30px; color: var(--text-light);">
                            <i class="fas fa-calendar-times" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>No appointments found</p>
                        </td>
                    </tr>
                `;
            }
        }

        function getStatusClass(status) {
            if (!status) return 'status-upcoming';
            status = status.toLowerCase();
            if (status.includes('complete')) return 'status-completed';
            if (status.includes('cancel')) return 'status-cancelled';
            return 'status-upcoming';
        }

        function getStatusText(status) {
            if (!status) return 'Upcoming';
            status = status.toLowerCase();
            if (status.includes('complete')) return 'Completed';
            if (status.includes('cancel')) return 'Cancelled';
            return 'Upcoming';
        }

        function getInitials(name) {
            if (!name) return '?';
            return name.split(' ').filter(n => n.length > 0).map(n => n[0]).join('').substring(0, 2);
        }

        function filterPatients() {
            const searchTerm = patientSearch.value.toLowerCase();
            filteredPatients = patients.filter(patient => {
                return patient.full_name.toLowerCase().includes(searchTerm) ||
                       (patient.email && patient.email.toLowerCase().includes(searchTerm)) ||
                       (patient.phone_number && patient.phone_number.includes(searchTerm));
            });
            displayAllPatients();
        }

        function showPatientDetails(patient) {
    console.log('Showing details for patient:', patient);  // Log patient data for inspection

    // Set patient name
    document.getElementById('modal-patient-name').textContent = patient.full_name || 'Unknown Patient';
    
    // Basic Information
    safeSetText('patient-dob', formatDate(patient.date_of_birth));
    safeSetText('patient-age', calculateAge(patient.date_of_birth) + ' years');
    safeSetText('patient-gender', patient.gender || 'Not specified');
    safeSetText('patient-blood', patient.blood_type || 'Unknown');
    
    // Contact Information
    safeSetText('patient-phone', patient.phone_number || 'Not provided');
    safeSetText('patient-address', patient.address || 'Not provided');
    
    // Health Summary
    safeSetText('patient-height', patient.height ? `${patient.height} cm` : 'Not available');
    safeSetText('patient-weight', patient.weight ? `${patient.weight} kg` : 'Not available');
    safeSetText('patient-bmi', calculateBMI(patient.weight, patient.height));
    safeSetText('patient-allergies', patient.allergies?.join(', ') || 'None reported');
    
    // Chronic Conditions
    if (patient.chronic_conditions && patient.chronic_conditions.length > 0) {
        console.log('Chronic conditions found:', patient.chronic_conditions);
        const chronicConditions = patient.chronic_conditions.map(cc => {
            console.log('Chronic condition object:', cc); // Log each chronic condition object
            return cc.name || 'Unnamed condition'; // Extract the name of each condition
        }).join(', ');
        safeSetText('patient-conditions', chronicConditions);
    } else {
        safeSetText('patient-conditions', 'None reported');
    }

    // Handle medications
    const medications = patient.medications?.length
        ? patient.medications.map(med => med.name || 'Unnamed medication').join(', ')
        : 'None reported';
    safeSetText('patient-medications', medications);

    // Handle latest vitals
    const latestVitals = patient.latest_vitals || 'No latest vitals available';
    safeSetText('patient-latest-vitals', latestVitals);
    
    // Find next appointment
    const nextAppointment = patient.upcoming_appointments?.find(apt => 
        new Date(apt.appointment_date) > new Date()
    );
    
    safeSetText('patient-next-appointment', 
        nextAppointment ? formatDateTime(nextAppointment.appointment_date) : 'Not scheduled'
    );

    // Show modal
    patientModal.style.display = 'flex';
}

        function logout() {
            localStorage.removeItem('access_token');
            window.location.href = '/doctor/login';
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', async () => {
            const accessToken = localStorage.getItem('access_token');
            if (!accessToken) {
                window.location.href = '/doctor/login';
                return;
            }

            setupEventListeners();
            await loadDoctorProfile();
            await loadPatients();
            await loadAppointments();
        });
    </script>
</body>
</html>